<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chaos Loop Studios | Intern Terminal</title>
    
    <!-- React Core -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Permanent+Marker&family=Rock+Salt&family=vt323&display=swap" rel="stylesheet">

    <!-- Styles -->
    <style>
        body {
            font-family: 'Courier Prime', monospace;
            background-color: #1a1a1a;
            color: #d4d4d4;
            overflow-x: hidden;
        }
        
        .font-marker { font-family: 'Permanent Marker', cursive; }
        .font-signature { font-family: 'Rock Salt', cursive; }
        .font-pixel { font-family: 'VT323', monospace; }

        /* CRT Overlay */
        .scanlines {
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.15) 50%,
                rgba(0,0,0,0.15)
            );
            background-size: 100% 4px;
            animation: scanlineMove 10s linear infinite;
            pointer-events: none;
            position: fixed;
            inset: 0;
            z-index: 50;
        }

        @keyframes scanlineMove {
            0% { background-position: 0 0; }
            100% { background-position: 0 100%; }
        }

        .paper-shadow {
            box-shadow: 0 1px 1px rgba(0,0,0,0.15), 
                        0 10px 0 -5px #eee, 
                        0 10px 1px -4px rgba(0,0,0,0.15), 
                        0 20px 0 -10px #eee, 
                        0 20px 1px -9px rgba(0,0,0,0.15);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #666; }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        studio: {
                            bg: '#121212',
                            paper: '#f3f4f6',
                            ink: '#1f2937',
                            accent: '#f59e0b', // Amber
                            terminal: '#10b981', // Emerald
                            error: '#ef4444',
                            highlight: '#3b82f6'
                        }
                    },
                    boxShadow: {
                        'crt': '0 0 20px rgba(16, 185, 129, 0.15)',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-studio-bg min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { motion, AnimatePresence } = window.Motion;

        // --- ASSETS & DATA ---

        const Icons = {
            Cube: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>,
            Server: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg>,
            Potion: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 22H5c-1.1 0-2-.9-2-2V9a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v11c0 1.1-.9 2-2 2z"/><line x1="12" y1="2" x2="12" y2="7"/><path d="M8 2h8"/></svg>,
            Bug: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="14" x="8" y="6" rx="4"/><path d="m19 7-3 3"/><path d="m5 7 3 3"/><path d="m19 19-3-3"/><path d="m5 19 3-3"/><path d="M2 12h6"/><path d="M16 12h6"/></svg>,
            Cloud: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.1-2.9-2.4-5.2-5.3-5.2-2.3 0-4.3 1.5-5 3.6-2.5.3-4.4 2.4-4.4 4.9 0 2.8 2.2 5 5 5h9.3c2.6 0 4.7-2.1 4.7-4.7z"/></svg>
        };

        const getItemIcon = (name) => {
            if (/Server|Latency|Ping|RAM|Storage|Load/.test(name)) return <Icons.Server />;
            if (/Potion|Elixir|Mana|Health|Stamina/.test(name)) return <Icons.Potion />;
            if (/Bug|Glitch|Exploit|Crash/.test(name)) return <Icons.Bug />;
            if (/Cloud|Network|Stream|Download/.test(name)) return <Icons.Cloud />;
            return <Icons.Cube />;
        };

        // Item Pool: No weapons, just "Game Dev" concepts
        const GAME_ASSETS = [
            "Potion of Hype", "Server Latency", "Hitbox Radius", "Jump Velocity", 
            "Loot Drop Rate", "Texture Resolution", "NPC Intelligence", "Microtransaction Cost",
            "Bloom Intensity", "Render Distance", "Loading Screen Time", "Character Charisma",
            "Mana Regen Tick", "Shadow Quality", "Physics Gravity", "Particle Count",
            "Walking Speed", "Inventory Slots", "Dialog Speed", "Experience Gain"
        ];

        // --- MATH ENGINE (Year 8 Curriculum) ---

        const generateLevelBatch = (level) => {
            const batchSize = 4;
            // Shuffle assets to ensure no duplicates in this batch
            const shuffledAssets = [...GAME_ASSETS].sort(() => 0.5 - Math.random());
            const items = [];
            const tasks = [];

            // Determine if we are in "Advanced Mode" (Decimal Multipliers)
            // Level 1-2: Pure Percentages (+20%)
            // Level 3+: Mixed Percentages and Decimals (* 1.2)
            const allowDecimals = level >= 3;

            // Pick 2 items to be "broken" (need fixing)
            const brokenIndices = new Set();
            while(brokenIndices.size < 2) brokenIndices.add(Math.floor(Math.random() * batchSize));

            for (let i = 0; i < batchSize; i++) {
                const name = shuffledAssets[i];
                const needsPatch = brokenIndices.has(i);
                
                let base, expected, operationType, value, displayValue;

                // Generate Base Value (Clean integers for easier mental math mostly)
                base = (Math.floor(Math.random() * 20) + 2) * 10; // 20, 30, ... 210

                if (needsPatch) {
                    const isBuff = Math.random() > 0.5;
                    // Percentage changes: 5%, 10%, 20%, 25%, 50%
                    const percentages = [5, 10, 20, 25, 50];
                    const percent = percentages[Math.floor(Math.random() * percentages.length)];
                    
                    const multiplier = isBuff ? (1 + percent/100) : (1 - percent/100);
                    
                    // Core Logic: Expected value is integer rounded
                    expected = Math.round(base * multiplier);

                    // Determine how to present the task to the student
                    const showAsDecimal = allowDecimals && Math.random() > 0.4; // 60% chance of decimal in later levels

                    if (showAsDecimal) {
                        displayValue = multiplier.toFixed(2); // e.g., "1.25" or "0.80"
                        // Remove trailing zero if exists for cleanliness (1.20 -> 1.2)
                        displayValue = parseFloat(displayValue).toString();
                        operationType = "Scale to";
                        tasks.push(`${operationType} ${name} by ${displayValue}x`);
                    } else {
                        displayValue = `${percent}%`;
                        operationType = isBuff ? "Buff" : "Nerf";
                        tasks.push(`${operationType} ${name} by ${displayValue}`);
                    }

                } else {
                    expected = base; // Stable item
                }

                items.push({
                    id: Math.random().toString(36).substr(2, 9),
                    name,
                    base,
                    needsPatch,
                    expected,
                    solved: !needsPatch, 
                    isStable: !needsPatch 
                });
            }

            return { items, tasks };
        };

        const getBowenMessage = (level) => {
            if (level === 1) return "Just sign the waiver and fix these. Don't touch my coffee.";
            if (level === 2) return "You didn't crash the server yet? Fine. Here's the beta branch.";
            if (level === 3) return "Marketing wants 'bigger numbers'. Use multipliers, it sounds smarter.";
            if (level === 4) return "I'm delegating my backlog to you. I have a... meeting. At the pub.";
            if (level >= 5) return "Look, if anyone asks, you're the Senior Dev now. I'm hiding under the desk.";
            return "Get back to work.";
        };

        // --- COMPONENTS ---

        const ContractScreen = ({ onStart }) => {
            const [name, setName] = useState("");

            return (
                <div className="min-h-screen bg-[#d1d5db] flex items-center justify-center p-4 font-mono text-studio-ink">
                    <motion.div 
                        initial={{ y: 50, opacity: 0 }}
                        animate={{ y: 0, opacity: 1 }}
                        className="bg-white max-w-2xl w-full paper-shadow p-8 md:p-12 relative rotate-1"
                    >
                        {/* Letterhead */}
                        <div className="flex justify-between items-start border-b-4 border-black pb-4 mb-8">
                            <div>
                                <h1 className="text-4xl font-bold tracking-tighter">CHAOS LOOP</h1>
                                <p className="text-sm tracking-widest uppercase mt-1">Interactive Entertainment & Tax Shelters</p>
                            </div>
                            <div className="w-16 h-16 border-4 border-black rounded-full flex items-center justify-center rotate-12">
                                <span className="font-bold text-xs text-center leading-none">NO<br/>REFUNDS</span>
                            </div>
                        </div>

                        {/* Content */}
                        <div className="space-y-6 text-sm md:text-base leading-relaxed">
                            <h2 className="text-xl font-bold underline decoration-4 decoration-yellow-400">UNPAID INTERNSHIP AGREEMENT</h2>
                            
                            <p>
                                I, the undersigned (hereinafter referred to as "The Fall Guy"), agree to optimize game balance parameters for Chaos Loop Studios.
                            </p>
                            
                            <div className="bg-gray-100 p-4 border-l-4 border-studio-error italic text-xs md:text-sm">
                                <strong>WARNING:</strong> The core codebase is held together by duct tape and prayers. Miscalculating a percentage yield by even 0.01% may result in server fires, player riots, or the sudden deletion of the CEO's save file.
                            </div>

                            <p>
                                My duties involve translating <span className="font-bold">Percentage Adjustments</span> and <span className="font-bold">Decimal Scalars</span> into integer database values. I understand that I will be paid in "Exposure" and stale donuts.
                            </p>
                        </div>

                        {/* Form */}
                        <div className="mt-12 space-y-4">
                            <div>
                                <label className="block font-bold text-xs uppercase mb-1">Intern Name (Print Clearly)</label>
                                <input 
                                    type="text" 
                                    value={name}
                                    onChange={(e) => setName(e.target.value)}
                                    placeholder="Enter your name..."
                                    className="w-full border-b-2 border-dashed border-black bg-transparent py-2 focus:outline-none font-marker text-xl text-blue-600"
                                />
                            </div>

                            <div className="flex items-center gap-4 pt-6">
                                <button 
                                    onClick={() => name && onStart(name)}
                                    disabled={!name}
                                    className={`
                                        px-8 py-4 font-bold text-white text-lg shadow-lg transition-transform active:scale-95
                                        ${name ? 'bg-studio-ink hover:bg-studio-accent -rotate-1 cursor-pointer' : 'bg-gray-400 cursor-not-allowed'}
                                    `}
                                >
                                    [ SIGN CONTRACT ]
                                </button>
                                <div className="text-[10px] uppercase text-gray-500 max-w-[150px] leading-tight">
                                    By clicking, you waive your right to sleep, bathroom breaks, and happiness.
                                </div>
                            </div>
                        </div>

                        {/* Stamp */}
                        <div className="absolute top-1/2 right-8 opacity-20 pointer-events-none rotate-[25deg]">
                            <div className="border-8 border-red-600 rounded p-4 text-red-600 font-black text-6xl uppercase tracking-widest">
                                URGENT
                            </div>
                        </div>
                    </motion.div>
                </div>
            );
        };

        const PostIt = ({ tasks, level }) => {
            return (
                <motion.div 
                    initial={{ rotate: 2, scale: 0.9 }}
                    animate={{ rotate: 2, scale: 1 }}
                    className="bg-yellow-200 text-gray-800 p-4 shadow-lg w-full max-w-xs relative mb-6 lg:mb-0"
                >
                    <div className="absolute -top-3 left-1/2 -translate-x-1/2 w-16 h-6 bg-yellow-100/50 backdrop-blur shadow rotate-1"></div>
                    
                    <div className="font-marker mb-4 border-b border-gray-400/30 pb-2">
                        <h3 className="text-xl">Bowen's Notes</h3>
                        <p className="font-sans text-xs text-gray-600">Sprint {level} // Priority: CRITICAL</p>
                    </div>

                    <p className="font-marker text-sm text-blue-800 mb-4 leading-snug">
                        "{getBowenMessage(level)}"
                    </p>

                    <div className="space-y-2 font-mono text-sm font-bold">
                        {tasks.map((task, i) => (
                            <div key={i} className="flex items-start gap-2">
                                <span className="text-red-600 mt-1">□</span>
                                <span>{task}</span>
                            </div>
                        ))}
                    </div>
                </motion.div>
            );
        };

        const TerminalRow = ({ item, onSolve, isProcessing }) => {
            const [val, setVal] = useState("");
            const [status, setStatus] = useState("idle"); // idle, success, error
            const inputRef = useRef(null);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (status === 'success' || isProcessing) return;

                if (item.isStable) {
                    handleError();
                    return;
                }

                const num = parseInt(val, 10);
                if (num === item.expected) {
                    setStatus("success");
                    onSolve(item.id, true);
                } else {
                    handleError();
                }
            };

            const handleError = () => {
                setStatus("error");
                onSolve(item.id, false);
                setVal("");
                setTimeout(() => setStatus("idle"), 800);
            };

            return (
                <div className={`
                    relative font-mono border-b border-gray-800 p-4 transition-colors duration-300
                    ${status === 'success' ? 'bg-studio-terminal/10' : ''}
                    ${status === 'error' ? 'bg-studio-error/10' : 'hover:bg-white/5'}
                `}>
                    <div className="flex items-center justify-between gap-4">
                        
                        {/* Left: Icon & Name */}
                        <div className="flex items-center gap-3 w-1/3">
                            <div className={`
                                w-10 h-10 flex items-center justify-center rounded 
                                ${status === 'success' ? 'text-studio-terminal' : 'text-gray-500'}
                            `}>
                                {getItemIcon(item.name)}
                            </div>
                            <div>
                                <div className={`font-bold text-sm ${item.solved ? 'text-studio-terminal' : 'text-white'}`}>
                                    {item.name}
                                </div>
                                <div className="text-xs text-gray-500">ID: {item.id}</div>
                            </div>
                        </div>

                        {/* Middle: Base Value */}
                        <div className="text-center w-1/4">
                            <div className="text-[10px] uppercase text-gray-500">Current Value</div>
                            <div className="text-lg font-bold text-studio-highlight">{item.base}</div>
                        </div>

                        {/* Right: Input Area */}
                        <div className="w-1/3">
                            {status === 'success' || item.solved ? (
                                <div className="flex items-center justify-end gap-2 text-studio-terminal font-bold">
                                    <span>{item.expected}</span>
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12" strokeWidth="3"/></svg>
                                    <span className="text-xs uppercase bg-studio-terminal/20 px-1 rounded">PATCHED</span>
                                </div>
                            ) : (
                                <form onSubmit={handleSubmit} className="flex gap-2">
                                    <input 
                                        ref={inputRef}
                                        type="number"
                                        value={val}
                                        onChange={(e) => setVal(e.target.value)}
                                        placeholder={item.isStable ? "NO CHANGE" : "NEW VAL"}
                                        className={`
                                            w-full bg-black border border-gray-700 rounded px-2 py-1 text-right font-bold focus:outline-none focus:border-studio-highlight
                                            ${status === 'error' ? 'border-studio-error text-studio-error animate-pulse' : 'text-white'}
                                        `}
                                        disabled={isProcessing}
                                    />
                                    <button 
                                        type="submit"
                                        className="bg-gray-800 hover:bg-studio-highlight text-white px-3 rounded text-sm transition-colors"
                                    >
                                        &gt;
                                    </button>
                                </form>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const MainTerminal = ({ playerName, level, onNextLevel, onRetry }) => {
            const [data, setData] = useState(null);
            const [budget, setBudget] = useState(100);
            const [gameTime, setGameTime] = useState(0); // Just for flavor
            const [statusMsg, setStatusMsg] = useState("CONNECTED TO PRODUCTION DB");

            // Init Level
            useEffect(() => {
                const newData = generateLevelBatch(level);
                setData(newData);
                setStatusMsg(`LOADING SPRINT ${level} TICKETS...`);
            }, [level]);

            // Timer Flavor
            useEffect(() => {
                const i = setInterval(() => setGameTime(t => t + 1), 1000);
                return () => clearInterval(i);
            }, []);

            const handleSolve = (id, isCorrect) => {
                if (isCorrect) {
                    setBudget(b => b + 150);
                    setStatusMsg("PATCH APPLIED SUCCESSFULLY. COMMITTING...");
                    setData(prev => ({
                        ...prev,
                        items: prev.items.map(i => i.id === id ? { ...i, solved: true } : i)
                    }));
                } else {
                    setBudget(b => Math.max(0, b - 50));
                    setStatusMsg("ERROR: INVALID PARAMETER. SERVER UNSTABLE.");
                }
            };

            const allSolved = data ? data.items.filter(i => i.needsPatch).every(i => i.solved) : false;

            if (!data) return <div className="text-center mt-20 font-mono text-studio-terminal animate-pulse">BOOTING...</div>;

            return (
                <div className="max-w-6xl mx-auto p-4 lg:p-8 flex flex-col lg:flex-row gap-8 items-start relative z-10">
                    
                    {/* Left Col: Tasks */}
                    <div className="w-full lg:w-1/3 flex flex-col gap-6">
                        <PostIt tasks={data.tasks} level={level} />
                        
                        {/* Stats Panel */}
                        <div className="bg-black border border-gray-700 p-4 font-mono text-xs">
                            <div className="flex justify-between mb-2">
                                <span className="text-gray-500">USER:</span>
                                <span className="text-white uppercase">{playerName}</span>
                            </div>
                            <div className="flex justify-between mb-2">
                                <span className="text-gray-500">ROLE:</span>
                                <span className="text-studio-highlight">INTERN (Lvl {level})</span>
                            </div>
                            <div className="flex justify-between mb-2">
                                <span className="text-gray-500">UPTIME:</span>
                                <span className="text-white">{gameTime}s</span>
                            </div>
                            <div className="border-t border-gray-800 my-2"></div>
                            <div className="flex justify-between items-center">
                                <span className="text-gray-500">PROJECT BUDGET:</span>
                                <span className={`text-xl font-bold ${budget < 100 ? 'text-studio-error' : 'text-studio-terminal'}`}>
                                    ${budget}k
                                </span>
                            </div>
                        </div>
                    </div>

                    {/* Right Col: Terminal */}
                    <div className="w-full lg:w-2/3">
                        <div className="bg-[#0c0c0c] border-2 border-gray-800 rounded-lg overflow-hidden shadow-crt relative">
                            
                            {/* Terminal Header */}
                            <div className="bg-gray-900 border-b border-gray-800 p-2 flex items-center justify-between">
                                <div className="flex gap-2">
                                    <div className="w-3 h-3 rounded-full bg-red-500"></div>
                                    <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                                    <div className="w-3 h-3 rounded-full bg-green-500"></div>
                                </div>
                                <div className="text-xs font-mono text-gray-500">bash -- chaos_patcher_v1.0</div>
                            </div>

                            {/* Status Bar */}
                            <div className="bg-studio-terminal/5 border-b border-studio-terminal/20 p-2 text-xs font-mono text-studio-terminal flex items-center gap-2">
                                <span className="animate-pulse">▶</span>
                                {statusMsg}
                            </div>

                            {/* Content */}
                            <div className="min-h-[400px]">
                                {data.items.map(item => (
                                    <TerminalRow key={item.id} item={item} onSolve={handleSolve} />
                                ))}
                            </div>

                            {/* Footer / Actions */}
                            <div className="bg-gray-900 border-t border-gray-800 p-4 flex justify-end">
                                {allSolved ? (
                                    <motion.button 
                                        initial={{ scale: 0.9 }}
                                        animate={{ scale: 1 }}
                                        onClick={onNextLevel}
                                        className="bg-studio-terminal text-black font-bold font-mono px-6 py-2 rounded shadow-[0_0_15px_rgba(16,185,129,0.5)] hover:bg-white transition-colors"
                                    >
                                        > DEPLOY PATCH & NEXT LEVEL
                                    </motion.button>
                                ) : (
                                    <div className="text-xs text-gray-500 font-mono py-2">
                                        // PENDING CHANGES...
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [gameState, setGameState] = useState("contract"); // contract, playing
            const [playerName, setPlayerName] = useState("");
            const [level, setLevel] = useState(1);

            const handleStart = (name) => {
                setPlayerName(name);
                setGameState("playing");
            };

            return (
                <div className="relative min-h-screen">
                    {/* Scanlines Overlay for that CRT feel */}
                    <div className="scanlines"></div>
                    
                    {gameState === 'contract' && (
                        <ContractScreen onStart={handleStart} />
                    )}

                    {gameState === 'playing' && (
                        <div className="pt-8">
                            <MainTerminal 
                                playerName={playerName} 
                                level={level} 
                                onNextLevel={() => setLevel(l => l + 1)}
                            />
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
