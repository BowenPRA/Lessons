<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Year 8 Wheel of Memory</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@500;700;800&family=Plus+Jakarta+Sans:wght@500;600;700&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            /* --- COLOR PALETTE: Deep Cosmic Theme --- */
            --bg-deep: #020617;
            --glass-panel: rgba(15, 23, 42, 0.85);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;

            /* UI Colors */
            --neon-blue: #3b82f6;
            --neon-cyan: #22d3ee;
            --neon-pink: #f43f5e;
            --neon-purple: #c084fc;
            --neon-green: #22c55e;
            --neon-orange: #f59e0b;

            --sidebar-width: 320px;
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-deep);
            background: radial-gradient(ellipse at bottom, #4c1d95 0%, #1e1b4b 40%, #020617 100%);
            color: var(--text-primary);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
        }

        /* --- STARFIELD ANIMATION --- */
        .stars {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(1.5px 1.5px at 20px 30px, #fff, rgba(0,0,0,0)),
                radial-gradient(1.5px 1.5px at 40px 70px, #fff, rgba(0,0,0,0)),
                radial-gradient(1.5px 1.5px at 50px 160px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 150px 200px, rgba(255,255,255,0.8), rgba(0,0,0,0));
            background-size: 300px 300px;
            animation: twinkle 120s linear infinite;
            z-index: -1;
            opacity: 0.6;
            pointer-events: none;
        }
        @keyframes twinkle { from { transform: translateY(0); } to { transform: translateY(-300px); } }

        /* --- LAYOUT --- */
        .app-container {
            display: flex; width: 100%; height: 100%; max-width: 1920px; margin: 0 auto;
        }

        /* --- SIDEBAR (STATS) --- */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--glass-panel);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            display: flex; flex-direction: column; padding: 1.5rem; gap: 1.5rem;
            z-index: 20;
            overflow-y: auto;
        }

        .brand {
            font-family: 'Outfit', sans-serif; font-weight: 800; font-size: 1.75rem;
            line-height: 1.1; color: #fff; text-shadow: 0 0 20px rgba(192, 132, 252, 0.4);
        }
        .brand span { color: var(--neon-cyan); }

        .stat-card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255,255,255,0.05);
            padding: 1.2rem; border-radius: 16px;
        }
        .stat-title { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .stat-value { font-family: 'Outfit'; font-size: 2.5rem; font-weight: 700; color: #fff; }
        .stat-sub { font-size: 0.9rem; color: var(--neon-cyan); }

        /* Progress Bar */
        .progress-bar-bg { background: rgba(255,255,255,0.1); height: 12px; border-radius: 6px; overflow: hidden; position: relative; }
        .progress-bar-fill { height: 100%; background: linear-gradient(90deg, var(--neon-blue), var(--neon-cyan)); width: 0%; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .goal-marker { height: 16px; width: 2px; background: #fff; position: absolute; top: -2px; left: 60%; box-shadow: 0 0 10px white; z-index: 5; }

        /* Lifelines */
        .lifeline-grid { display: flex; flex-direction: column; gap: 10px; }
        .lifeline-btn {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            padding: 12px; border-radius: 12px; color: #fff; cursor: pointer;
            transition: all 0.2s;
        }
        .lifeline-btn:hover:not(:disabled) { background: rgba(255,255,255,0.1); transform: translateX(5px); }
        .lifeline-btn:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); }
        .lifeline-icon { width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.1); border-radius: 50%; margin-right: 10px; color: var(--neon-cyan); }
        .lifeline-text { flex: 1; font-family: 'Outfit'; font-weight: 600; font-size: 0.9rem; text-align: left; }
        .lifeline-count { font-weight: 800; color: var(--neon-pink); background: rgba(0,0,0,0.3); padding: 2px 8px; border-radius: 4px; }

        /* --- MAIN ARENA --- */
        .arena {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 2rem; position: relative;
        }

        /* --- TOP HEADER (Current Student) --- */
        .turn-display {
            font-family: 'Outfit'; font-size: 2.5rem; font-weight: 700;
            margin-bottom: 2rem; text-align: center; height: 60px;
            text-shadow: 0 0 25px rgba(34, 211, 238, 0.3);
            opacity: 0; transform: translateY(-20px); transition: all 0.5s ease;
            z-index: 10;
        }
        .turn-display.active { opacity: 1; transform: translateY(0); }
        .student-name { color: var(--neon-pink); }

        /* --- SPLIT CONTENT --- */
        .content-split {
            display: flex; width: 100%; max-width: 1400px; height: 600px; gap: 3rem; align-items: center;
        }

        /* --- LEFT: WHEEL --- */
        .wheel-area {
            flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative;
        }
        
        .wheel-container {
            width: 400px; height: 400px; position: relative;
            border-radius: 50%;
            /* Thick border with inner shadow for depth */
            border: 8px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 50px rgba(0,0,0,0.3), inset 0 0 30px rgba(0,0,0,0.5);
            transition: transform 4s cubic-bezier(0.1, 0.9, 0.2, 1);
            overflow: hidden;
            margin-bottom: 20px;
            background: #020617; /* Fallback */
        }

        .wheel {
            width: 100%; height: 100%; border-radius: 50%;
            position: relative;
            /* Conic gradient is now injected by JS for dynamic slicing */
            transition: all 0.3s ease;
        }
        
        /* Wheel Names overlay */
        .wheel-names { position: absolute; top:0; left:0; width:100%; height:100%; border-radius:50%; }
        .wheel-name {
            position: absolute; top: 50%; left: 50%;
            transform-origin: 0 0;
            width: 50%; height: 2px;
            display: flex; align-items: center;
            padding-left: 50px; /* Push text to edge */
            font-family: 'Outfit'; font-weight: 800; font-size: 1.1rem; color: #fff;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            /* Stronger shadow for neon background readability */
            text-shadow: 0 1px 3px rgba(0,0,0,0.8), 0 0 5px rgba(0,0,0,0.5);
        }

        /* Center Hub / Spin Button */
        .spin-btn {
            width: 90px; height: 90px; border-radius: 50%;
            background: linear-gradient(145deg, #ffffff, #e2e8f0);
            border: 4px solid rgba(255,255,255,0.5);
            cursor: pointer;
            font-family: 'Outfit'; font-weight: 800; color: var(--bg-deep);
            font-size: 1.1rem; letter-spacing: 1px;
            box-shadow: 0 0 20px rgba(255,255,255,0.2), inset 0 0 10px rgba(0,0,0,0.1);
            transition: all 0.2s;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 15;
            display: flex; align-items: center; justify-content: center;
        }
        .spin-btn::after {
            content: ''; position: absolute; width: 85%; height: 85%; border-radius: 50%;
            border: 2px dashed #cbd5e1; opacity: 0.5;
        }
        .spin-btn:hover { transform: translate(-50%, -50%) scale(1.05); box-shadow: 0 0 30px rgba(255,255,255,0.4); }
        .spin-btn:disabled { background: #334155; border-color: #475569; color: #64748b; cursor: default; transform: translate(-50%, -50%) scale(1); box-shadow: none; }

        .wheel-pointer {
            position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; 
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid var(--neon-orange);
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.6));
            z-index: 20;
        }
        
        /* Spin Controls */
        .control-group { display: flex; gap: 10px; z-index: 15; flex-direction: column; align-items: center; }

        .manual-btn {
            background: transparent; color: var(--neon-cyan); border: 1px solid var(--neon-cyan);
            padding: 8px 16px; border-radius: 50px; font-family: 'Outfit'; font-size: 0.9rem; cursor: pointer;
            transition: all 0.2s; margin-top: 10px;
        }
        .manual-btn:hover { background: rgba(34, 211, 238, 0.1); }

        /* --- RIGHT: QUESTION CARD --- */
        .card-area {
            flex: 1.3; perspective: 1000px;
        }
        
        .card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 3rem;
            min-height: 400px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px;
            background: linear-gradient(90deg, var(--neon-purple), var(--neon-cyan), var(--neon-pink));
        }

        /* Views */
        .cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; width: 100%; display: none; }
        .cat-btn {
            padding: 1.5rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px; color: #fff; font-family: 'Outfit'; font-size: 1.2rem; cursor: pointer;
            transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        .cat-btn:hover { background: rgba(34, 211, 238, 0.2); border-color: var(--neon-cyan); transform: translateY(-3px); }

        .q-display { display: none; width: 100%; flex-direction: column; align-items: center; gap: 1.5rem; }
        .badge {
            padding: 6px 16px; border-radius: 50px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
            display: inline-block; margin-bottom: 10px;
        }
        .badge-rookie { background: rgba(34, 197, 94, 0.2); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.4); }
        .badge-pro { background: rgba(59, 130, 246, 0.2); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.4); }
        .badge-boss { background: rgba(244, 63, 94, 0.2); color: #fb7185; border: 1px solid rgba(244, 63, 94, 0.4); }

        .question-text { font-size: 1.5rem; line-height: 1.4; margin-bottom: 1rem; }
        .answer-text { 
            font-size: 1.3rem; color: var(--neon-cyan); font-weight: 600; 
            min-height: 60px; display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s;
        }
        .answer-text.visible { opacity: 1; }

        .controls { display: flex; gap: 1rem; margin-top: 1rem; width: 100%; justify-content: center; }
        .btn {
            padding: 12px 24px; border-radius: 8px; border: none; font-weight: 700; font-family: 'Outfit'; cursor: pointer;
            transition: all 0.2s; color: #fff;
        }
        .btn-reveal { background: #475569; width: 100%; max-width: 300px; }
        .btn-reveal:hover { background: #64748b; }
        
        .btn-correct { background: var(--neon-green); box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4); }
        .btn-wrong { background: var(--neon-pink); box-shadow: 0 4px 15px rgba(244, 63, 94, 0.4); }
        .btn-action { display: none; min-width: 120px; }

        /* Manual Pick Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.9); display: none; align-items: center; justify-content: center; z-index: 100;
            backdrop-filter: blur(5px); opacity: 0; transition: opacity 0.3s;
        }
        .modal-overlay.active { opacity: 1; }

        .modal-card {
            background: #1e293b; padding: 2.5rem; border-radius: 20px; text-align: center; 
            border: 1px solid rgba(255,255,255,0.1); width: 90%; max-width: 500px;
            box-shadow: 0 0 40px rgba(0,0,0,0.5); transform: translateY(20px); transition: transform 0.3s;
        }
        .modal-overlay.active .modal-card { transform: translateY(0); }
        
        .student-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px;
            margin-top: 20px;
        }
        .student-btn {
            background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3);
            color: white; padding: 12px; border-radius: 8px; cursor: pointer;
            font-family: 'Outfit'; transition: all 0.2s;
        }
        .student-btn:hover { background: var(--neon-blue); color: #020617; }
        .close-modal {
            margin-top: 20px; background: transparent; border: none; color: #94a3b8; cursor: pointer; text-decoration: underline;
        }

        /* Confetti */
        #confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 200; }

    </style>
</head>
<body>

    <div class="stars"></div>
    <canvas id="confetti"></canvas>

    <div class="app-container">
        <!-- SIDEBAR -->
        <nav class="sidebar">
            <div class="brand">Year 8<br><span>Wheel of Memory</span></div>
            
            <!-- SCORE -->
            <div class="stat-card">
                <div class="stat-title">Class Score</div>
                <div class="stat-value" id="score-percent">0%</div>
                <div class="stat-sub"><span id="score-correct">0</span> / <span id="score-total">0</span> Correct</div>
                
                <div style="position: relative; height: 12px; margin-top: 15px;">
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="progress-fill"></div>
                    </div>
                    <!-- 60% Marker -->
                    <div class="goal-marker" title="60% Goal"></div>
                </div>
                <div class="stat-title" style="margin-top:5px; text-align: right;">Goal: 60%</div>
            </div>

            <!-- LIFELINES -->
            <div class="stat-card">
                <div class="stat-title">Class Lifelines</div>
                <div class="lifeline-grid">
                    <button class="lifeline-btn" id="life-notes" onclick="game.useLifeline('notes')">
                        <div style="display:flex; align-items:center;">
                            <div class="lifeline-icon"><i class="fas fa-book-open"></i></div>
                            <span class="lifeline-text">Use Notes</span>
                        </div>
                        <span class="lifeline-count" id="count-notes">3</span>
                    </button>
                    
                    <button class="lifeline-btn" id="life-friend" onclick="game.useLifeline('friend')">
                        <div style="display:flex; align-items:center;">
                            <div class="lifeline-icon"><i class="fas fa-user-friends"></i></div>
                            <span class="lifeline-text">Ask Friend</span>
                        </div>
                        <span class="lifeline-count" id="count-friend">2</span>
                    </button>

                    <button class="lifeline-btn" id="life-bowen" onclick="game.useLifeline('bowen')">
                        <div style="display:flex; align-items:center;">
                            <div class="lifeline-icon"><i class="fas fa-user-tie"></i></div>
                            <span class="lifeline-text">Ask Mr. Bowen</span>
                        </div>
                        <span class="lifeline-count" id="count-bowen">1</span>
                    </button>
                </div>
            </div>

            <!-- POOL -->
            <div class="stat-card" style="margin-top: auto;">
                <div class="stat-title">Students Remaining</div>
                <div style="display: flex; justify-content: space-between; align-items: baseline;">
                    <div class="stat-value" style="font-size: 1.5rem;" id="students-left-count">9</div>
                    <button class="btn btn-reveal" onclick="game.resetStudents()" style="width:auto; padding: 6px 12px; font-size: 0.7rem; background:#334155;">Reset</button>
                </div>
            </div>
        </nav>

        <!-- MAIN GAME -->
        <main class="arena">
            
            <!-- HEADER -->
            <div class="turn-display" id="turn-display">
                <span id="turn-text">Spin the Wheel!</span>
            </div>

            <div class="content-split">
                
                <!-- WHEEL AREA -->
                <div class="wheel-area">
                    <div class="wheel-pointer"></div>
                    <div class="wheel-container" id="wheel-container">
                        <div class="wheel" id="wheel-graphic">
                            <!-- JS generates segments -->
                        </div>
                        <div class="wheel-names" id="wheel-names">
                            <!-- JS generates names -->
                        </div>
                        <button class="spin-btn" id="spin-btn" onclick="game.spinWheel()">SPIN</button>
                    </div>
                    
                    <div class="control-group">
                        <button class="manual-btn" onclick="game.openManualPick()"><i class="fas fa-hand-pointer"></i> Manual Pick</button>
                    </div>
                </div>

                <!-- CARD AREA -->
                <div class="card-area">
                    <div class="card">
                        
                        <!-- State 0: Intro -->
                        <div id="view-intro">
                            <h2 style="font-family:'Outfit'; font-size:2rem; margin-bottom:1rem; color:var(--neon-cyan);">Ready?</h2>
                            <p style="color:#cbd5e1; font-size:1.2rem;">Select a student to begin.</p>
                        </div>

                        <!-- State 1: Category Select -->
                        <div id="view-categories" class="cat-grid">
                            <!-- Injected by JS -->
                        </div>

                        <!-- State 2: Question -->
                        <div id="view-question" class="q-display">
                            <div id="q-badge" class="badge">Rookie</div>
                            <div id="q-topic" style="color:var(--text-secondary); font-size:0.9rem; text-transform:uppercase; letter-spacing:1px;">Topic</div>
                            <div id="q-text" class="question-text">Question goes here...</div>
                            
                            <div id="a-text" class="answer-text">Answer Hidden</div>

                            <div class="controls">
                                <button id="btn-reveal" class="btn btn-reveal" onclick="game.revealAnswer()">Reveal Answer</button>
                                <button id="btn-correct" class="btn btn-correct btn-action" onclick="game.handleResult(true)"><i class="fas fa-check"></i> Correct</button>
                                <button id="btn-wrong" class="btn btn-wrong btn-action" onclick="game.handleResult(false)"><i class="fas fa-times"></i> Wrong</button>
                            </div>
                        </div>

                        <!-- State 3: Empty Categories -->
                        <div id="view-empty" style="display:none; flex-direction:column; align-items:center;">
                            <h2 style="font-family:'Outfit'; color:var(--neon-pink); margin-bottom: 1rem;">Category Completed!</h2>
                            <p style="margin-bottom: 1rem;">All questions in this category have been asked.</p>
                            <button class="btn btn-reveal" style="width: auto;" onclick="game.showCategories()">Pick Another</button>
                        </div>

                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- MANUAL PICK MODAL -->
    <div class="modal-overlay" id="manual-modal">
        <div class="modal-card">
            <h2 style="font-family:'Outfit'; color:#fff; margin-bottom: 10px;">Manual Selection</h2>
            <p style="color:#94a3b8; font-size: 0.9rem; margin-bottom: 20px;">Choose a student from the active pool.</p>
            
            <div class="student-grid" id="manual-list">
                <!-- JS Injects Buttons Here -->
            </div>

            <button class="close-modal" onclick="document.getElementById('manual-modal').classList.remove('active'); setTimeout(() => document.getElementById('manual-modal').style.display='none', 300);">Cancel</button>
        </div>
    </div>

    <script>
        /**
         * CAMBRIDGE TRIVIA ENGINE
         * Updated with Manual Pick & Lifelines
         */

        // --- DATA ---
        const ALL_STUDENTS = ["Meelo", "Vy", "Bao", "Chris", "Khoi", "Angelo", "Jackson", "Kun", "Kim Long"];
        
        const CATEGORIES = {
            "Light & Color": [
                { id: 1, type: "Rookie", q: "In 1666, which famous scientist used a prism to split white light into a spectrum?", a: "Isaac Newton" },
                { id: 2, type: "Rookie", q: "What is the scientific name for the process where white light splits into different colors inside a prism?", a: "Dispersion" },
                { id: 3, type: "Rookie", q: "What are the three Primary Colors of light?", a: "Red, Green, and Blue" },
                { id: 4, type: "Rookie", q: "True or False: A green filter blocks green light.", a: "False (It transmits green)" },
                { id: 5, type: "Pro", q: "List the three Secondary Colors of light.", a: "Cyan, Magenta, and Yellow" },
                { id: 6, type: "Pro", q: "If you mix Red light and Green light together, what color do you get?", a: "Yellow" },
                { id: 7, type: "Pro", q: "If white light shines on a red shirt, what color does it appear, and why?", a: "Red (Reflects red, absorbs others)" },
                { id: 8, type: "Pro", q: "An RGB code is (255, 0, 255). What color does this create?", a: "Magenta" },
                { id: 9, type: "Boss", q: "Which color of light travels the slowest in glass and therefore bends the most?", a: "Violet" },
                { id: 10, type: "Boss", q: "We don’t see a blue sky because of reflection. What is the process where blue light bounces off gas particles?", a: "Scattering (Rayleigh)" },
                { id: 11, type: "Boss", q: "Explain why a Red shirt looks Black in a room lit only by Blue light.", a: "It absorbs the blue light, reflecting nothing." }
            ],
            "Space & Universe": [
                { id: 12, type: "Rookie", q: "A galaxy is a huge group of stars, gas, and dust held together by what force?", a: "Gravity" },
                { id: 13, type: "Rookie", q: "What is the name of our home galaxy?", a: "The Milky Way" },
                { id: 14, type: "Rookie", q: "True or False: The Asteroid Belt is located between Earth and Mars.", a: "False (Between Mars & Jupiter)" },
                { id: 15, type: "Pro", q: "Astronomers classify galaxies into three main shapes. Name two of them.", a: "Spiral, Elliptical, or Irregular" },
                { id: 16, type: "Pro", q: "Ceres is spherical and in the asteroid belt. What is it classified as?", a: "A Dwarf Planet" },
                { id: 17, type: "Pro", q: "Order from smallest to largest: Solar System, Universe, Galaxy.", a: "Solar System → Galaxy → Universe" },
                { id: 18, type: "Boss", q: "Why do scientists sometimes call asteroids 'Space Potatoes'?", a: "They have irregular, lumpy shapes due to low gravity." },
                { id: 19, type: "Boss", q: "Approximately how wide is the Milky Way galaxy?", a: "100,000 Light Years" },
                { id: 20, type: "Boss", q: "Explain the difference between an Asteroid, a Comet, and a Meteor.", a: "Asteroid: Rock/Metal. Comet: Ice/Dust. Meteor: Entering Atmosphere." }
            ],
            "Refraction": [
                { id: 21, type: "Rookie", q: "What is the definition of Refraction?", a: "Bending of light passing between mediums." },
                { id: 22, type: "Rookie", q: "What is the approximate speed of light in air?", a: "300,000 km/s" },
                { id: 23, type: "Pro", q: "Refraction happens because light changes its ________ when entering a new material.", a: "Speed" },
                { id: 24, type: "Pro", q: "Light from Air (less dense) to Glass (denser): bends Towards or Away from normal?", a: "Towards the normal" },
                { id: 25, type: "Pro", q: "Cameras use glass lenses. What part of the human body acts like a lens?", a: "The Eye" },
                { id: 26, type: "Boss", q: "Why does a hidden coin in a cup become visible when you pour water in?", a: "Refraction bends light over the rim to your eye." },
                { id: 27, type: "Boss", q: "If you look at a straw in a glass of water, it appears broken. Why?", a: "Refraction (Optical Illusion)" }
            ],
            "Mathematics": [
                { id: 28, type: "Rookie", q: "Function: x → [×4] → [+7] → y. If x is 2, what is y?", a: "15" },
                { id: 29, type: "Rookie", q: "Identify the y-intercept: y = 4x + 3", a: "3" },
                { id: 30, type: "Rookie", q: "Calculate y for y = 10 - x when x = -3.", a: "13" },
                { id: 31, type: "Pro", q: "If y = x + 8, what is the inverse function?", a: "y = x - 8" },
                { id: 32, type: "Pro", q: "In y = mx + c, what does m represent?", a: "The Gradient (Steepness)" },
                { id: 33, type: "Pro", q: "T/F: y = 3x + 4 is parallel to y = 3x - 10.", a: "True (Same gradient)" },
                { id: 34, type: "Pro", q: "Which is Non-Linear? A) y=4x or B) y=x²?", a: "B) y = x²" },
                { id: 35, type: "Boss", q: "Find the midpoint between (0,0) and (8,4).", a: "(4, 2)" },
                { id: 36, type: "Boss", q: "Find intersection: y = x and y = 3.", a: "(3, 3)" }
            ]
        };

        // --- GAME LOGIC ---
        const game = {
            students: [...ALL_STUDENTS],
            stats: { total: 0, correct: 0 },
            lifelines: { notes: 3, friend: 2, bowen: 1 },
            indexes: { "Light & Color": 0, "Space & Universe": 0, "Refraction": 0, "Mathematics": 0 },
            currentPlayer: null,
            currentQ: null,
            isSpinning: false,

            // UI Elements
            ui: {
                wheel: document.getElementById('wheel-container'),
                wheelGraphic: document.getElementById('wheel-graphic'),
                wheelNames: document.getElementById('wheel-names'),
                spinBtn: document.getElementById('spin-btn'),
                turnDisplay: document.getElementById('turn-display'),
                turnText: document.getElementById('turn-text'),
                
                // Views
                viewIntro: document.getElementById('view-intro'),
                viewCats: document.getElementById('view-categories'),
                viewQ: document.getElementById('view-question'),
                viewEmpty: document.getElementById('view-empty'),
                
                // Q Elements
                badge: document.getElementById('q-badge'),
                topic: document.getElementById('q-topic'),
                qText: document.getElementById('q-text'),
                aText: document.getElementById('a-text'),
                btnReveal: document.getElementById('btn-reveal'),
                btnCorrect: document.getElementById('btn-correct'),
                btnWrong: document.getElementById('btn-wrong'),

                // Modals
                manualModal: document.getElementById('manual-modal'),
                manualList: document.getElementById('manual-list')
            },

            init() {
                this.renderWheel();
                this.updateStats();
                this.renderCategories();
                this.updateLifelinesUI();
                confettiEffects.init();
            },

            renderWheel() {
                const count = this.students.length;
                const degPerSlice = 360 / count;
                this.ui.wheelNames.innerHTML = '';
                
                // --- Dynamic Gradient Construction ---
                // We use 3 repeating colors: Cyan, Purple, Pink
                const wheelColors = ['#22d3ee', '#c084fc', '#f43f5e'];
                let gradientStr = 'conic-gradient(';

                // Add pointer adjustment offset to start at top (optional, but 0deg is usually Top in conic)
                // Actually conic 0deg is Top.
                
                this.students.forEach((name, i) => {
                    // 1. Setup Background Slice
                    const color = wheelColors[i % 3];
                    const startDeg = i * degPerSlice;
                    const endDeg = (i + 1) * degPerSlice;
                    
                    gradientStr += `${color} ${startDeg}deg ${endDeg}deg,`;

                    // 2. Setup Name Text
                    const nameEl = document.createElement('div');
                    nameEl.className = 'wheel-name';
                    nameEl.innerText = name;
                    // Rotate to center of slice
                    const rotateDeg = startDeg + (degPerSlice / 2);
                    // -90deg offset often needed because text flows horizontal, we want it radial
                    // But here we want text radiating OUT from center.
                    nameEl.style.transform = `rotate(${rotateDeg}deg)`;
                    this.ui.wheelNames.appendChild(nameEl);
                });
                
                // Clean up trailing comma and close
                gradientStr = gradientStr.slice(0, -1) + ')';
                this.ui.wheelGraphic.style.background = gradientStr;
            },

            spinWheel() {
                if (this.isSpinning) return;
                if (this.students.length === 0) {
                    alert("All students have been called! Refilling pool...");
                    this.resetStudents();
                    return;
                }

                this.isSpinning = true;
                this.ui.spinBtn.disabled = true;
                this.ui.turnDisplay.classList.remove('active');

                // Logic: Random winner
                const winnerIndex = Math.floor(Math.random() * this.students.length);
                const winnerName = this.students[winnerIndex];
                
                // Visuals: Spin
                const sliceAngle = 360 / this.students.length;
                
                // Target angle: Center of the winning slice
                // Note: The pointer is at TOP (0 deg visually). 
                // The gradient starts at 0deg (Top).
                // So if Index 0 wins, it occupies 0 to X degrees. Center is X/2.
                // To get X/2 to the Top, we need to rotate negative X/2.
                
                const targetCenterAngle = (winnerIndex * sliceAngle) + (sliceAngle / 2);
                
                const spins = 1800; // 5 full spins (360 * 5)
                
                // Calculate rotation needed to bring target to top (0deg)
                // We rotate the container clockwise.
                // If Target is at 10deg. We need to rotate -10deg to bring it to 0.
                // But we want to spin forward (positive).
                // So we spin (360 - 10) = 350deg.
                
                const rotateAmount = spins + (360 - targetCenterAngle);

                this.ui.wheel.style.transform = `rotate(${rotateAmount}deg)`;

                setTimeout(() => {
                    this.startTurn(winnerName, winnerIndex);
                    // Reset Wheel CSS for next spin
                    setTimeout(() => {
                        this.ui.wheel.style.transition = 'none';
                        this.ui.wheel.style.transform = 'rotate(0deg)';
                        void this.ui.wheel.offsetWidth; // Force Reflow
                        this.ui.wheel.style.transition = 'transform 4s cubic-bezier(0.1, 0.9, 0.2, 1)';
                    }, 500);
                }, 4000);
            },

            openManualPick() {
                if (this.students.length === 0) {
                    alert("No students left to pick! Resetting pool...");
                    this.resetStudents();
                    return;
                }

                this.ui.manualList.innerHTML = '';
                this.students.forEach((name, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'student-btn';
                    btn.innerText = name;
                    btn.onclick = () => {
                        this.closeManualModal();
                        this.startTurn(name, idx);
                    };
                    this.ui.manualList.appendChild(btn);
                });

                this.ui.manualModal.style.display = 'flex';
                // Trigger transition
                setTimeout(() => this.ui.manualModal.classList.add('active'), 10);
            },

            closeManualModal() {
                this.ui.manualModal.classList.remove('active');
                setTimeout(() => this.ui.manualModal.style.display = 'none', 300);
            },

            startTurn(name, index) {
                this.isSpinning = false;
                this.currentPlayer = name;
                
                // Remove from pool
                this.students.splice(index, 1);
                this.renderWheel();
                this.updateStats();

                // UI Updates
                this.ui.spinBtn.disabled = false;
                this.ui.turnText.innerHTML = `<span class="student-name">${name}</span> is up!`;
                this.ui.turnDisplay.classList.add('active');
                this.showCategories();
            },

            showCategories() {
                this.ui.viewIntro.style.display = 'none';
                this.ui.viewQ.style.display = 'none';
                this.ui.viewEmpty.style.display = 'none';
                this.ui.viewCats.style.display = 'grid';
            },

            selectCategory(catName) {
                const idx = this.indexes[catName];
                const list = CATEGORIES[catName];
                
                if (idx >= list.length) {
                    this.ui.viewCats.style.display = 'none';
                    this.ui.viewEmpty.style.display = 'flex';
                    return;
                }

                this.currentQ = list[idx];
                
                // Render Question
                this.ui.badge.innerText = this.currentQ.type;
                this.ui.badge.className = `badge badge-${this.currentQ.type.toLowerCase()}`;
                this.ui.topic.innerText = catName;
                this.ui.qText.innerText = this.currentQ.q;
                this.ui.aText.innerText = this.currentQ.a;
                this.ui.aText.classList.remove('visible');
                
                // Reset Buttons
                this.ui.btnReveal.style.display = 'block';
                this.ui.btnCorrect.style.display = 'none';
                this.ui.btnWrong.style.display = 'none';

                // Switch View
                this.ui.viewCats.style.display = 'none';
                this.ui.viewQ.style.display = 'flex';
            },

            revealAnswer() {
                this.ui.aText.classList.add('visible');
                this.ui.btnReveal.style.display = 'none';
                this.ui.btnCorrect.style.display = 'block';
                this.ui.btnWrong.style.display = 'block';
            },

            handleResult(isCorrect) {
                this.stats.total++;
                if (isCorrect) {
                    this.stats.correct++;
                    confettiEffects.fire(); // Small burst for correct answer
                }
                
                const catName = this.ui.topic.innerText;
                this.indexes[catName]++;
                this.updateStats();

                // Return to start
                this.ui.viewQ.style.display = 'none';
                this.ui.viewIntro.style.display = 'block';
                this.ui.turnDisplay.classList.remove('active');
                
                // Reset text
                this.ui.turnText.innerText = "Spin the Wheel!";
                setTimeout(() => this.ui.turnDisplay.classList.add('active'), 100);
            },

            useLifeline(type) {
                if (this.lifelines[type] > 0) {
                    this.lifelines[type]--;
                    this.updateLifelinesUI();
                }
            },

            updateLifelinesUI() {
                ['notes', 'friend', 'bowen'].forEach(type => {
                    const btn = document.getElementById(`life-${type}`);
                    const countEl = document.getElementById(`count-${type}`);
                    const count = this.lifelines[type];
                    
                    countEl.innerText = count;
                    if (count === 0) {
                        btn.disabled = true;
                    } else {
                        btn.disabled = false;
                    }
                });
            },

            updateStats() {
                const percent = this.stats.total === 0 ? 0 : Math.round((this.stats.correct / this.stats.total) * 100);
                
                document.getElementById('score-percent').innerText = percent + "%";
                document.getElementById('score-correct').innerText = this.stats.correct;
                document.getElementById('score-total').innerText = this.stats.total;
                document.getElementById('progress-fill').style.width = percent + "%";
                document.getElementById('students-left-count').innerText = this.students.length;

                const pEl = document.getElementById('score-percent');
                if (percent >= 60) pEl.style.color = "var(--neon-green)";
                else if (percent > 0) pEl.style.color = "var(--neon-pink)";
                else pEl.style.color = "#fff";
            },

            resetStudents() {
                this.students = [...ALL_STUDENTS];
                this.renderWheel();
                this.updateStats();
            },

            renderCategories() {
                this.ui.viewCats.innerHTML = '';
                Object.keys(CATEGORIES).forEach(cat => {
                    const btn = document.createElement('div');
                    btn.className = 'cat-btn';
                    
                    let icon = 'fa-star';
                    if(cat.includes('Light')) icon = 'fa-lightbulb';
                    if(cat.includes('Space')) icon = 'fa-rocket';
                    if(cat.includes('Refraction')) icon = 'fa-glasses';
                    if(cat.includes('Math')) icon = 'fa-calculator';

                    btn.innerHTML = `<i class="fas ${icon}" style="font-size: 2rem; color:var(--neon-cyan); margin-bottom: 5px;"></i> <span>${cat}</span>`;
                    btn.onclick = () => this.selectCategory(cat);
                    this.ui.viewCats.appendChild(btn);
                });
            }
        };

        // --- VISUALS ---
        const confettiEffects = {
            canvas: null,
            ctx: null,
            particles: [],
            
            init() {
                this.canvas = document.getElementById('confetti');
                this.ctx = this.canvas.getContext('2d');
                this.resize();
                window.addEventListener('resize', () => this.resize());
                this.animate();
            },

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            },

            fire() {
                const colors = ['#22d3ee', '#f43f5e', '#c084fc', '#f59e0b', '#22c55e'];
                for(let i=0; i<100; i++) {
                    this.particles.push({
                        x: window.innerWidth / 2,
                        y: window.innerHeight / 2,
                        vx: (Math.random() - 0.5) * 20,
                        vy: (Math.random() - 0.5) * 20,
                        size: Math.random() * 5 + 2,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        life: 1
                    });
                }
            },

            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                for(let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.5; // Gravity
                    p.life -= 0.02;

                    if(p.life <= 0) {
                        this.particles.splice(i, 1);
                    } else {
                        this.ctx.globalAlpha = p.life;
                        this.ctx.fillStyle = p.color;
                        this.ctx.beginPath();
                        this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                        this.ctx.fill();
                        this.ctx.globalAlpha = 1;
                    }
                }
                requestAnimationFrame(() => this.animate());
            }
        };

        // Start
        game.init();

    </script>
</body>
</html>
