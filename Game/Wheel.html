<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Year 8 Wheel of Memory</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&family=Plus+Jakarta+Sans:wght@500;600;700&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            /* --- COLOR PALETTE: Deep Cosmic Theme --- */
            --bg-deep: #020617;
            --glass-panel: rgba(15, 23, 42, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;

            /* Neon Accents */
            --neon-blue: #3b82f6;
            --neon-cyan: #06b6d4;
            --neon-pink: #f43f5e;
            --neon-purple: #a855f7;
            --neon-green: #22c55e;
            --neon-orange: #f59e0b;
            
            /* Dimensions */
            --sidebar-width: 300px;
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-deep);
            background: radial-gradient(circle at 50% 100%, #1e1b4b 0%, #020617 60%);
            color: var(--text-primary);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: row;
        }

        /* --- STARFIELD ANIMATION --- */
        .stars {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(1.5px 1.5px at 20px 30px, #fff, rgba(0,0,0,0)),
                radial-gradient(1.5px 1.5px at 40px 70px, #fff, rgba(0,0,0,0)),
                radial-gradient(1.5px 1.5px at 50px 160px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 150px 200px, rgba(255,255,255,0.8), rgba(0,0,0,0));
            background-size: 500px 500px;
            animation: twinkle 100s linear infinite;
            z-index: -1;
            opacity: 0.5;
            pointer-events: none;
        }
        @keyframes twinkle { from { transform: translateY(0); } to { transform: translateY(-500px); } }

        /* --- LOBBY (SETUP SCREEN) --- */
        .lobby-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.95);
            backdrop-filter: blur(20px);
            z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s ease;
        }
        .lobby-card {
            background: #0f172a; border: 1px solid var(--glass-border);
            padding: 2rem; border-radius: 24px; width: 90%; max-width: 500px;
            text-align: center; box-shadow: 0 0 50px rgba(59, 130, 246, 0.2);
        }
        .lobby-title { font-family: 'Outfit'; font-size: 2rem; margin-bottom: 1rem; color: #fff; }
        .lobby-input-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem; margin: 1.5rem 0;
            max-height: 40vh; overflow-y: auto; padding: 5px;
        }
        .student-input {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: #fff; padding: 10px; border-radius: 8px; font-family: 'Outfit';
            text-align: center; outline: none; transition: all 0.2s;
        }
        .student-input:focus { border-color: var(--neon-cyan); background: rgba(6, 182, 212, 0.1); }
        .btn-start {
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-purple));
            color: white; border: none; padding: 1rem 3rem; border-radius: 50px;
            font-family: 'Outfit'; font-weight: 800; font-size: 1.2rem; cursor: pointer;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
            transition: all 0.2s; margin-top: 1rem;
        }
        .btn-start:hover { transform: scale(1.05); box-shadow: 0 0 40px rgba(168, 85, 247, 0.6); }

        /* --- LAYOUT --- */
        .app-container {
            display: flex; width: 100%; height: 100%; max-width: 1920px; margin: 0 auto;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--glass-panel);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            display: flex; flex-direction: column; padding: 1.5rem; gap: 1.5rem;
            z-index: 50; overflow-y: auto;
            flex-shrink: 0;
        }

        .brand {
            font-family: 'Outfit', sans-serif; font-weight: 800; font-size: 1.5rem;
            line-height: 1.1; color: #fff; text-shadow: 0 0 20px rgba(192, 132, 252, 0.4);
        }
        .brand span { color: var(--neon-cyan); }

        .stat-card {
            background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(255,255,255,0.05);
            padding: 1rem; border-radius: 16px;
        }
        .stat-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .stat-value { font-family: 'Outfit'; font-size: 2rem; font-weight: 700; color: #fff; }
        .stat-sub { font-size: 0.85rem; color: var(--neon-cyan); }

        /* Progress Bar */
        .progress-bar-bg { background: rgba(255,255,255,0.1); height: 8px; border-radius: 4px; overflow: hidden; position: relative; margin-top: 10px; }
        .progress-bar-fill { height: 100%; background: linear-gradient(90deg, var(--neon-blue), var(--neon-cyan)); width: 0%; transition: width 0.5s ease; }
        .goal-marker { height: 12px; width: 2px; background: #fff; position: absolute; top: -2px; left: 60%; box-shadow: 0 0 8px white; z-index: 5; }

        /* Lifelines */
        .lifeline-grid { display: flex; flex-direction: column; gap: 8px; }
        .lifeline-btn {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
            padding: 10px 12px; border-radius: 12px; color: #fff; cursor: pointer;
            transition: all 0.2s;
        }
        .lifeline-btn:hover:not(:disabled) { background: rgba(255,255,255,0.1); border-color: var(--neon-purple); }
        .lifeline-btn:disabled { opacity: 0.3; cursor: not-allowed; filter: grayscale(1); }
        .lifeline-icon { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.1); border-radius: 50%; margin-right: 10px; color: var(--neon-cyan); font-size: 0.8rem; }
        .lifeline-text { flex: 1; font-family: 'Outfit'; font-weight: 600; font-size: 0.85rem; text-align: left; }
        .lifeline-count { font-weight: 800; color: var(--neon-pink); background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; }

        /* --- MAIN ARENA --- */
        .arena {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 2rem; position: relative;
            overflow: hidden;
        }

        /* --- TURN HEADER --- */
        .turn-display {
            font-family: 'Outfit'; font-size: clamp(1.5rem, 4vw, 2.5rem); font-weight: 700;
            margin-bottom: 2rem; text-align: center; min-height: 60px;
            text-shadow: 0 0 25px rgba(34, 211, 238, 0.3);
            opacity: 0; transform: translateY(-20px); transition: all 0.5s ease;
            z-index: 10;
        }
        .turn-display.active { opacity: 1; transform: translateY(0); }
        .student-name { color: var(--neon-pink); }

        /* --- SPLIT CONTENT --- */
        .content-split {
            display: flex; width: 100%; max-width: 1400px; 
            flex: 1; gap: 3rem; align-items: center; justify-content: center;
        }

        /* --- WHEEL COMPONENT (Refactored) --- */
        .wheel-area {
            flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative; min-width: 300px;
        }

        /* The physical container */
        .wheel-wrapper {
            /* Fluid sizing for mobile & desktop */
            width: clamp(280px, 50vmin, 500px);
            aspect-ratio: 1 / 1;
            position: relative;
            border-radius: 50%;
            /* Metallic Bezel */
            box-shadow: 
                0 0 0 10px #1e293b,
                0 0 0 12px #334155,
                0 0 0 13px rgba(34, 211, 238, 0.5), /* Neon ring */
                0 20px 50px rgba(0,0,0,0.6);
            margin-bottom: 2rem;
            z-index: 5;
            /* Container clip for clean edges */
            overflow: visible;
        }

        /* The Rotator - Single source of truth for rotation */
        .wheel-rotator {
            width: 100%; height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            transition: transform 4s cubic-bezier(0.15, 0.85, 0.35, 1);
        }

        .wheel-background {
            position: absolute; top:0; left:0; width:100%; height:100%;
            border-radius: 50%;
        }
        
        /* Inner shadow for depth */
        .wheel-overlay {
            position: absolute; inset: 0; border-radius: 50%; pointer-events: none;
            box-shadow: inset 0 0 40px rgba(0,0,0,0.6);
            border: 4px solid rgba(255,255,255,0.05);
            z-index: 2;
        }

        .wheel-text-layer {
            position: absolute; inset: 0; border-radius: 50%;
            pointer-events: none; z-index: 3;
        }
        
        .wheel-name-segment {
            position: absolute; top: 50%; left: 50%;
            width: 50%; height: 0px; /* Zero height, text centered */
            transform-origin: 0 0;
            display: flex; align-items: center; justify-content: flex-end;
            padding-right: 40px; /* Push text in from edge */
        }
        
        .wheel-text {
            color: #fff; font-family: 'Outfit'; font-weight: 800; 
            font-size: clamp(0.8rem, 2vmin, 1.2rem); 
            text-transform: uppercase; white-space: nowrap;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* Center Hub */
        .wheel-hub {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 22%; height: 22%; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #e2e8f0, #94a3b8);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            z-index: 10;
            display: flex; align-items: center; justify-content: center;
            border: 4px solid #1e293b;
        }
        
        /* Spin Button inside Hub */
        .btn-spin {
            width: 100%; height: 100%; border-radius: 50%; border: none; background: transparent;
            color: #0f172a; font-family: 'Outfit'; font-weight: 900; font-size: clamp(0.8rem, 1.5vmin, 1.2rem);
            cursor: pointer; transition: all 0.2s;
        }
        .btn-spin:active { transform: scale(0.95); }
        .btn-spin:disabled { opacity: 0.5; cursor: not-allowed; color: #475569; }

        /* The Flapper/Pointer */
        .wheel-pointer {
            position: absolute; 
            top: 50%; 
            right: -30px; 
            left: auto; /* Reset left */
            transform: translateY(-50%) rotate(90deg); /* Rotate to point Left */
            z-index: 20;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5));
        }
        .pointer-body {
            width: 40px; height: 50px;
            background: linear-gradient(to bottom, var(--neon-pink), #be123c);
            clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 50% 85%, 0% 100%);
            border-top: 2px solid rgba(255,255,255,0.5);
        }

        .control-group { margin-top: 10px; display: flex; flex-direction: column; align-items: center; }
        .manual-btn {
            background: transparent; color: var(--neon-cyan); border: 1px solid var(--neon-cyan);
            padding: 8px 20px; border-radius: 50px; font-family: 'Outfit'; font-size: 0.9rem; cursor: pointer;
            transition: all 0.2s;
        }
        .manual-btn:hover { background: rgba(34, 211, 238, 0.1); transform: translateY(-2px); }

        /* --- CARD AREA --- */
        .card-area {
            flex: 1.2; perspective: 1000px; width: 100%; max-width: 600px;
        }
        
        .game-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: clamp(1.5rem, 3vw, 3rem);
            min-height: 400px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            text-align: center;
            position: relative; overflow: hidden;
            transition: transform 0.3s;
        }
        .game-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, var(--neon-purple), var(--neon-cyan), var(--neon-pink));
        }

        /* Views */
        .cat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; width: 100%; display: none; }
        .cat-btn {
            padding: 1rem; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px; color: #fff; font-family: 'Outfit'; font-size: 1rem; cursor: pointer;
            transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 6px;
            position: relative; overflow: hidden;
        }
        .cat-btn:hover { background: rgba(255,255,255,0.08); border-color: var(--neon-cyan); transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .cat-btn.disabled { opacity: 0.5; cursor: default; border-color: transparent; }
        .cat-btn.disabled:hover { transform: none; background: rgba(255,255,255,0.03); }

        .cat-icon-box { margin-bottom: 5px; }
        .cat-icon-box i { font-size: 1.6rem; color: var(--neon-cyan); }
        
        /* Stats inside Category Button */
        .cat-meta {
            display: flex; gap: 8px; font-size: 0.75rem; margin-top: 5px; width: 100%; justify-content: center;
        }
        .cat-badge {
            padding: 2px 8px; border-radius: 4px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .cat-count {
            background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 4px; color: #94a3b8;
        }

        /* Difficulty Colors */
        .diff-rookie { color: #4ade80; background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.3); }
        .diff-pro { color: #60a5fa; background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.3); }
        .diff-boss { color: #fb7185; background: rgba(244, 63, 94, 0.15); border: 1px solid rgba(244, 63, 94, 0.3); }
        .diff-done { color: #94a3b8; background: rgba(148, 163, 184, 0.1); border: 1px solid rgba(148, 163, 184, 0.2); }

        .q-display { display: none; width: 100%; flex-direction: column; align-items: center; gap: 1.5rem; }
        
        .badge { padding: 6px 16px; border-radius: 50px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; display: inline-block; margin-bottom: 5px; }
        .badge-rookie { background: rgba(34, 197, 94, 0.15); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.3); }
        .badge-pro { background: rgba(59, 130, 246, 0.15); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.3); }
        .badge-boss { background: rgba(244, 63, 94, 0.15); color: #fb7185; border: 1px solid rgba(244, 63, 94, 0.3); }

        .question-text { font-size: clamp(1.1rem, 2.5vw, 1.6rem); line-height: 1.4; margin-bottom: 0.5rem; font-weight: 500; }
        .answer-box { 
            background: rgba(0,0,0,0.2); border-radius: 12px; padding: 1.5rem; width: 100%;
            min-height: 80px; display: flex; align-items: center; justify-content: center;
            margin: 1rem 0; border: 1px dashed rgba(255,255,255,0.1);
        }
        .answer-text { 
            font-size: clamp(1rem, 2vw, 1.3rem); color: var(--neon-cyan); font-weight: 700; 
            opacity: 0; transform: translateY(10px); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .answer-text.visible { opacity: 1; transform: translateY(0); }

        .controls { display: flex; gap: 0.8rem; width: 100%; justify-content: center; flex-wrap: wrap; }
        .btn { padding: 12px 24px; border-radius: 8px; border: none; font-weight: 700; font-family: 'Outfit'; cursor: pointer; transition: all 0.2s; color: #fff; font-size: 1rem; }
        
        .btn-reveal { background: #334155; width: 100%; max-width: 250px; }
        .btn-reveal:hover { background: #475569; }
        
        .btn-correct { background: var(--neon-green); box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3); flex: 1; max-width: 150px; }
        .btn-wrong { background: var(--neon-pink); box-shadow: 0 4px 15px rgba(244, 63, 94, 0.3); flex: 1; max-width: 150px; }
        .btn-action { display: none; }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.8); backdrop-filter: blur(5px);
            display: none; align-items: center; justify-content: center; z-index: 200;
            opacity: 0; transition: opacity 0.3s;
        }
        .modal-overlay.active { opacity: 1; }
        .modal-card-manual {
            background: #1e293b; padding: 2rem; border-radius: 20px; width: 90%; max-width: 450px;
            border: 1px solid rgba(255,255,255,0.1); text-align: center;
            transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal-overlay.active .modal-card-manual { transform: scale(1); }
        
        .student-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 20px; max-height: 50vh; overflow-y: auto; }
        .student-btn {
            background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3);
            color: white; padding: 12px; border-radius: 8px; cursor: pointer; font-family: 'Outfit'; transition: all 0.2s;
        }
        .student-btn:hover { background: var(--neon-blue); color: #020617; }

        #confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 300; }

        /* --- RESPONSIVE BREAKPOINTS --- */
        @media (max-width: 900px) {
            body { flex-direction: column; overflow-y: auto; }
            .app-container { flex-direction: column; height: auto; min-height: 100vh; }
            
            .sidebar { 
                width: 100%; height: auto; flex-direction: row; align-items: center; 
                border-right: none; border-bottom: 1px solid var(--glass-border);
                padding: 1rem; overflow-x: auto; flex-wrap: wrap; justify-content: space-between;
                background: rgba(15, 23, 42, 0.95);
            }
            .brand { font-size: 1.2rem; }
            .stat-card { padding: 0.8rem; min-width: 140px; }
            .stat-value { font-size: 1.5rem; }
            
            /* Hide pool on mobile top bar to save space */
            .sidebar .stat-card:last-child { display: none; }
            /* Hide lifelines on mobile top bar, maybe move to bottom? kept simplified */
            
            .content-split { flex-direction: column; gap: 2rem; padding: 1rem; margin-top: 1rem; }
            .wheel-area { width: 100%; }
            .card-area { width: 100%; padding-bottom: 2rem; }
            
            .lobby-input-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .turn-display { margin-bottom: 1rem; font-size: 1.8rem; }
            .sidebar { gap: 10px; }
            .stat-card { flex: 1; }
            .btn { width: 100%; max-width: none; }
            .controls { flex-direction: column; }
        }
    </style>
</head>
<body>

    <div class="stars"></div>
    <canvas id="confetti"></canvas>

    <!-- SETUP LOBBY -->
    <div id="lobby" class="lobby-overlay">
        <div class="lobby-card">
            <h1 class="lobby-title">Class Setup</h1>
            <p style="color:var(--text-secondary);">Verify players for today's session.</p>
            
            <div class="lobby-input-grid" id="lobby-grid">
                <!-- JS Injects Inputs -->
            </div>
            
            <button class="btn-start" onclick="game.startGame()">ENTER CLASS</button>
        </div>
    </div>

    <div class="app-container" id="app" style="opacity: 0; transition: opacity 1s;">
        <!-- SIDEBAR -->
        <nav class="sidebar">
            <div class="brand">Year 8<br><span>Wheel of Memory</span></div>
            
            <!-- SCORE -->
            <div class="stat-card">
                <div class="stat-title">Class Performance</div>
                <div class="stat-value" id="score-percent">0%</div>
                <div class="stat-sub"><span id="score-correct">0</span> / <span id="score-total">0</span> Correct</div>
                
                <div style="position: relative; height: auto;">
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="progress-fill"></div>
                    </div>
                </div>
            </div>

            <!-- LIFELINES -->
            <div class="stat-card" style="flex:1; display:flex; flex-direction:column; justify-content:center;">
                <div class="stat-title">Lifelines</div>
                <div class="lifeline-grid">
                    <button class="lifeline-btn" id="life-notes" onclick="game.useLifeline('notes')">
                        <div style="display:flex; align-items:center;">
                            <div class="lifeline-icon"><i class="fas fa-book-open"></i></div>
                            <span class="lifeline-text">Use Notes</span>
                        </div>
                        <span class="lifeline-count" id="count-notes">3</span>
                    </button>
                    
                    <button class="lifeline-btn" id="life-friend" onclick="game.useLifeline('friend')">
                        <div style="display:flex; align-items:center;">
                            <div class="lifeline-icon"><i class="fas fa-user-friends"></i></div>
                            <span class="lifeline-text">Ask Friend</span>
                        </div>
                        <span class="lifeline-count" id="count-friend">2</span>
                    </button>

                    <button class="lifeline-btn" id="life-bowen" onclick="game.useLifeline('bowen')">
                        <div style="display:flex; align-items:center;">
                            <div class="lifeline-icon"><i class="fas fa-user-tie"></i></div>
                            <span class="lifeline-text">Ask Teacher</span>
                        </div>
                        <span class="lifeline-count" id="count-bowen">1</span>
                    </button>
                </div>
            </div>

            <!-- POOL STATS -->
            <div class="stat-card">
                <div class="stat-title">Pool</div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="stat-sub">Remaining</div>
                    <div class="stat-value" style="font-size: 1.5rem;" id="students-left-count">0</div>
                </div>
                <button onclick="game.resetStudents()" style="width:100%; margin-top:10px; padding:8px; background:rgba(255,255,255,0.1); border:none; color:#94a3b8; border-radius:6px; cursor:pointer; font-size:0.8rem;">Reset Pool</button>
            </div>
        </nav>

        <!-- MAIN GAME -->
        <main class="arena">
            
            <div class="turn-display" id="turn-display">
                <span id="turn-text">Spin the Wheel!</span>
            </div>

            <div class="content-split">
                
                <!-- WHEEL AREA -->
                <div class="wheel-area">
                    <div class="wheel-pointer">
                        <div class="pointer-body"></div>
                    </div>
                    
                    <div class="wheel-wrapper">
                        <!-- Single Rotator Container containing both background and text to prevent drift -->
                        <div class="wheel-rotator" id="wheel-rotator">
                            <div class="wheel-background" id="wheel-background"></div>
                            <div class="wheel-text-layer" id="wheel-names"></div>
                        </div>
                        <div class="wheel-overlay"></div>
                        
                        <!-- HUB -->
                        <div class="wheel-hub">
                            <button class="btn-spin" id="spin-btn" onclick="game.spinWheel()">SPIN</button>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <button class="manual-btn" onclick="game.openManualPick()"><i class="fas fa-hand-pointer"></i> Manual Pick</button>
                    </div>
                </div>

                <!-- CARD AREA -->
                <div class="card-area">
                    <div class="game-card">
                        
                        <!-- State 0: Intro -->
                        <div id="view-intro">
                            <h2 style="font-family:'Outfit'; font-size:2rem; margin-bottom:1rem; color:var(--neon-cyan);">Ready Player?</h2>
                            <p style="color:#cbd5e1; font-size:1.1rem; line-height:1.6;">Use the wheel to select the next student.<br>Questions vary in difficulty.</p>
                        </div>

                        <!-- State 1: Category Select -->
                        <div id="view-categories" class="cat-grid">
                            <!-- Injected by JS -->
                        </div>

                        <!-- State 2: Question -->
                        <div id="view-question" class="q-display">
                            <div id="q-badge" class="badge">Rookie</div>
                            <div id="q-topic" style="color:var(--text-secondary); font-size:0.85rem; text-transform:uppercase; letter-spacing:1px; margin-bottom:1rem;">Topic</div>
                            
                            <div id="q-text" class="question-text">Question goes here...</div>
                            
                            <div class="answer-box">
                                <div id="a-text" class="answer-text">Answer Hidden</div>
                            </div>

                            <div class="controls">
                                <button id="btn-reveal" class="btn btn-reveal" onclick="game.revealAnswer()">Reveal Answer</button>
                                <button id="btn-correct" class="btn btn-correct btn-action" onclick="game.handleResult(true)"><i class="fas fa-check"></i> Correct</button>
                                <button id="btn-wrong" class="btn btn-wrong btn-action" onclick="game.handleResult(false)"><i class="fas fa-times"></i> Wrong</button>
                            </div>
                        </div>

                        <!-- State 3: Empty Categories -->
                        <div id="view-empty" style="display:none; flex-direction:column; align-items:center;">
                            <div style="font-size:3rem; margin-bottom:1rem;">ðŸŽ‰</div>
                            <h2 style="font-family:'Outfit'; color:var(--neon-pink); margin-bottom: 1rem;">Category Complete!</h2>
                            <p style="margin-bottom: 2rem; color: var(--text-secondary);">All questions in this topic have been answered.</p>
                            <button class="btn btn-reveal" style="width: auto;" onclick="game.showCategories()">Pick Another</button>
                        </div>

                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- MANUAL PICK MODAL -->
    <div class="modal-overlay" id="manual-modal">
        <div class="modal-card-manual">
            <h2 style="font-family:'Outfit'; color:#fff; margin-bottom: 5px;">Manual Selection</h2>
            <p style="color:#94a3b8; font-size: 0.9rem; margin-bottom: 20px;">Choose a student from the active pool.</p>
            
            <div class="student-grid" id="manual-list">
                <!-- JS Injects Buttons Here -->
            </div>

            <button style="margin-top:20px; background:transparent; border:none; color:#cbd5e1; text-decoration:underline; cursor:pointer;" onclick="game.closeManualModal()">Cancel</button>
        </div>
    </div>

    <script>
        /**
         * ENGINE: Year 8 Wheel of Memory v2.0
         * Features: Responsive Wheel Physics, Lobby System, Deep Cosmic Theme
         */

        // --- DATA ---
        const DEFAULT_ROSTER = ["Meelo", "Bao", "Chris", "Khoi", "Angelo", "Jackson", "Kun", "Kim Long", "Vy", "Minh VU"];
        
        const CATEGORIES = {
            "Light & Color": [
                { id: 1, type: "Rookie", q: "In 1666, which famous scientist used a prism to split white light into a spectrum?", a: "Isaac Newton" },
                { id: 2, type: "Rookie", q: "What is the scientific name for the process where white light splits into different colors inside a prism?", a: "Dispersion" },
                { id: 3, type: "Rookie", q: "What are the three Primary Colors of light?", a: "Red, Green, and Blue" },
                { id: 4, type: "Rookie", q: "True or False: A green filter blocks green light.", a: "False (It transmits green)" },
                { id: 5, type: "Pro", q: "List the three Secondary Colors of light.", a: "Cyan, Magenta, and Yellow" },
                { id: 6, type: "Pro", q: "If you mix Red light and Green light together, what color do you get?", a: "Yellow" },
                { id: 7, type: "Pro", q: "If white light shines on a red shirt, what color does it appear, and why?", a: "Red (Reflects red, absorbs others)" },
                { id: 8, type: "Pro", q: "An RGB code is (255, 0, 255). What color does this create?", a: "Magenta" },
                { id: 9, type: "Boss", q: "Which color of light travels the slowest in glass and therefore bends the most?", a: "Violet" },
                { id: 10, type: "Boss", q: "We donâ€™t see a blue sky because of reflection. What is the process where blue light bounces off gas particles?", a: "Scattering (Rayleigh)" },
                { id: 11, type: "Boss", q: "Explain why a Red shirt looks Black in a room lit only by Blue light.", a: "It absorbs the blue light, reflecting nothing." }
            ],
            "Space & Universe": [
                { id: 12, type: "Rookie", q: "A galaxy is a huge group of stars, gas, and dust held together by what force?", a: "Gravity" },
                { id: 13, type: "Rookie", q: "What is the name of our home galaxy?", a: "The Milky Way" },
                { id: 14, type: "Rookie", q: "True or False: The Asteroid Belt is located between Earth and Mars.", a: "False (Between Mars & Jupiter)" },
                { id: 15, type: "Pro", q: "Astronomers classify galaxies into three main shapes. Name two of them.", a: "Spiral, Elliptical, or Irregular" },
                { id: 16, type: "Pro", q: "Ceres is spherical and in the asteroid belt. What is it classified as?", a: "A Dwarf Planet" },
                { id: 17, type: "Pro", q: "Order from smallest to largest: Solar System, Universe, Galaxy.", a: "Solar System â†’ Galaxy â†’ Universe" },
                { id: 18, type: "Boss", q: "Why do scientists sometimes call asteroids 'Space Potatoes'?", a: "They have irregular, lumpy shapes due to low gravity." },
                { id: 19, type: "Boss", q: "Approximately how wide is the Milky Way galaxy?", a: "100,000 Light Years" },
                { id: 20, type: "Boss", q: "Explain the difference between an Asteroid, a Comet, and a Meteor.", a: "Asteroid: Rock/Metal. Comet: Ice/Dust. Meteor: Entering Atmosphere." }
            ],
            "Refraction": [
                { id: 21, type: "Rookie", q: "What is the definition of Refraction?", a: "Bending of light passing between mediums." },
                { id: 22, type: "Rookie", q: "What is the approximate speed of light in air?", a: "300,000 km/s" },
                { id: 23, type: "Pro", q: "Refraction happens because light changes its ________ when entering a new material.", a: "Speed" },
                { id: 24, type: "Pro", q: "Light from Air (less dense) to Glass (denser): bends Towards or Away from normal?", a: "Towards the normal" },
                { id: 25, type: "Pro", q: "Cameras use glass lenses. What part of the human body acts like a lens?", a: "The Eye" },
                { id: 26, type: "Boss", q: "Why does a hidden coin in a cup become visible when you pour water in?", a: "Refraction bends light over the rim to your eye." },
                { id: 27, type: "Boss", q: "If you look at a straw in a glass of water, it appears broken. Why?", a: "Refraction (Optical Illusion)" }
            ],
            "Mathematics": [
                { id: 28, type: "Rookie", q: "Function: x â†’ [Ã—4] â†’ [+7] â†’ y. If x is 2, what is y?", a: "15" },
                { id: 29, type: "Rookie", q: "Identify the y-intercept: y = 4x + 3", a: "3" },
                { id: 30, type: "Rookie", q: "Calculate y for y = 10 - x when x = -3.", a: "13" },
                { id: 31, type: "Pro", q: "If y = x + 8, what is the inverse function?", a: "y = x - 8" },
                { id: 32, type: "Pro", q: "In y = mx + c, what does m represent?", a: "The Gradient (Steepness)" },
                { id: 33, type: "Pro", q: "T/F: y = 3x + 4 is parallel to y = 3x - 10.", a: "True (Same gradient)" },
                { id: 34, type: "Pro", q: "Which is Non-Linear? A) y=4x or B) y=xÂ²?", a: "B) y = xÂ²" },
                { id: 35, type: "Boss", q: "Find the midpoint between (0,0) and (8,4).", a: "(4, 2)" },
                { id: 36, type: "Boss", q: "Find intersection: y = x and y = 3.", a: "(3, 3)" }
            ]
        };

        // --- GAME STATE ---
        const game = {
            activeStudents: [],
            initialStudents: [],
            stats: { total: 0, correct: 0 },
            lifelines: { notes: 3, friend: 2, bowen: 1 },
            indexes: { "Light & Color": 0, "Space & Universe": 0, "Refraction": 0, "Mathematics": 0 },
            currentRotation: 0,
            
            // State tracking
            isSpinning: false,
            turnActive: false, // Locks wheel until turn is done
            currentPlayer: null,
            currentCategory: null,
            currentQ: null,

            // UI Cache
            ui: {
                wheelRotator: document.getElementById('wheel-rotator'),
                wheelBackground: document.getElementById('wheel-background'),
                wheelNames: document.getElementById('wheel-names'),
                spinBtn: document.getElementById('spin-btn'),
                turnDisplay: document.getElementById('turn-display'),
                turnText: document.getElementById('turn-text'),
                app: document.getElementById('app'),
                lobby: document.getElementById('lobby'),
                lobbyGrid: document.getElementById('lobby-grid'),
                
                // Views
                intro: document.getElementById('view-intro'),
                cats: document.getElementById('view-categories'),
                question: document.getElementById('view-question'),
                empty: document.getElementById('view-empty'),
            },

            // --- LOBBY PHASE ---
            initLobby() {
                // Populate grid with default inputs
                this.ui.lobbyGrid.innerHTML = '';
                DEFAULT_ROSTER.forEach(name => {
                    const input = document.createElement('input');
                    input.className = 'student-input';
                    input.value = name;
                    input.placeholder = "Player Name";
                    this.ui.lobbyGrid.appendChild(input);
                });
                
                // Add a few empty slots for flexibility
                for(let i=0; i<2; i++){
                    const input = document.createElement('input');
                    input.className = 'student-input';
                    input.placeholder = "Empty Slot";
                    this.ui.lobbyGrid.appendChild(input);
                }
            },

            startGame() {
                // Gather names
                const inputs = Array.from(this.ui.lobbyGrid.querySelectorAll('input'));
                const names = inputs.map(i => i.value.trim()).filter(n => n.length > 0);
                
                if (names.length < 2) {
                    alert("Please enter at least 2 players.");
                    return;
                }

                this.initialStudents = [...names];
                this.activeStudents = [...names];
                
                // Transition
                this.ui.lobby.style.opacity = '0';
                setTimeout(() => {
                    this.ui.lobby.style.display = 'none';
                    this.ui.app.style.opacity = '1';
                    this.renderWheel();
                    this.updateStats();
                    this.renderCategories();
                    confettiEffects.init();
                }, 500);
            },

            // --- WHEEL LOGIC ---
            renderWheel() {
                const count = this.activeStudents.length;
                const sliceAngle = 360 / count;
                this.ui.wheelNames.innerHTML = '';
                
                // 1. Generate Gradient
                const colors = ['#22d3ee', '#c084fc', '#f43f5e', '#22c55e', '#f59e0b', '#3b82f6'];
                let gradientStr = 'conic-gradient(';
                
                this.activeStudents.forEach((name, i) => {
                    const color = colors[i % colors.length];
                    const start = i * sliceAngle;
                    const end = (i + 1) * sliceAngle;
                    gradientStr += `${color} ${start}deg ${end}deg,`;

                    // 2. Generate Text Segment
                    // To center text in slice, we rotate it to start + half_slice
                    // KEY FIX: Offset by -90deg because HTML elements at 0deg are Horizontal (3 o'clock)
                    // but CSS Gradients at 0deg are Vertical (12 o'clock).
                    const textRotation = start + (sliceAngle / 2) - 90;
                    
                    const seg = document.createElement('div');
                    seg.className = 'wheel-name-segment';
                    // Rotate the container to the middle of the slice
                    seg.style.transform = `rotate(${textRotation}deg)`;
                    
                    const text = document.createElement('span');
                    text.className = 'wheel-text';
                    text.innerText = name;
                    
                    seg.appendChild(text);
                    this.ui.wheelNames.appendChild(seg);
                });

                gradientStr = gradientStr.slice(0, -1) + ')';
                this.ui.wheelBackground.style.background = gradientStr;
            },

            spinWheel() {
                if (this.isSpinning) return;
                
                // Prevent spin if previous turn isn't done (unless it's the very first spin)
                if (this.turnActive) {
                    alert("Please finish the current turn before spinning again!");
                    return;
                }

                if (this.activeStudents.length === 0) {
                    this.resetStudents();
                    return;
                }

                this.isSpinning = true;
                this.turnActive = true; // Lock the turn
                this.ui.spinBtn.disabled = true;
                this.ui.turnDisplay.classList.remove('active');

                // 1. Pick Winner
                const winnerIndex = Math.floor(Math.random() * this.activeStudents.length);
                const winnerName = this.activeStudents[winnerIndex];

                // 2. Calculate Math
                const sliceAngle = 360 / this.activeStudents.length;
                
                // Center of the winner slice relative to wheel start (0deg)
                const centerAngle = (winnerIndex * sliceAngle) + (sliceAngle / 2);
                
                // We want the wheel's rotation to end such that this centerAngle matches the POINTER location
                // POINTER IS AT RIGHT (90deg).
                // If wheel is at rotation R, the visual angle of center is (centerAngle + R).
                // We want (centerAngle + R) % 360 == 90.
                // So R should be 90 - centerAngle.
                
                let targetFromZero = 90 - centerAngle; 
                
                // Add fuzz
                const fuzz = (Math.random() * (sliceAngle * 0.4)) - (sliceAngle * 0.2);
                targetFromZero += fuzz;

                // 3. Find next rotation value that matches targetFromZero
                // We want to spin forward at least 5 times (1800deg)
                const minSpins = 5;
                const fullSpins = 360 * minSpins;
                
                // Current visual rotation
                const current = this.currentRotation;
                
                // Calculate remainder of current rotation
                const currentMod = current % 360;
                
                // Distance to next aligned position
                let distance = targetFromZero - currentMod;
                if (distance < 0) {
                    distance += 360; // Wrap around to ensure positive forward motion
                }
                
                // Add minimum spins
                const finalRotation = current + distance + fullSpins;
                
                this.currentRotation = finalRotation;
                
                // Apply rotation to the wrapper that holds both bg and text
                this.ui.wheelRotator.style.transform = `rotate(${this.currentRotation}deg)`;

                // 3. Finish
                setTimeout(() => {
                    this.startTurn(winnerName, winnerIndex);
                }, 4000);
            },

            startTurn(name, index) {
                this.isSpinning = false;
                this.currentPlayer = name;
                
                // Remove from pool logic
                this.activeStudents.splice(index, 1);
                
                // Visual delay then re-render
                this.ui.spinBtn.disabled = true; // Still disabled until question answered
                this.ui.turnText.innerHTML = `<span class="student-name">${name}</span> is up!`;
                this.ui.turnDisplay.classList.add('active');
                
                // DO NOT reset rotation here. Leave the wheel rotated to the winner.
                
                this.updateStats();
                this.showCategories();
            },

            // --- VIEW MANAGEMENT ---
            showCategories() {
                this.ui.intro.style.display = 'none';
                this.ui.question.style.display = 'none';
                this.ui.empty.style.display = 'none';
                this.ui.cats.style.display = 'grid';
                this.renderCategories(); // Re-render to show difficulty badges
            },

            selectCategory(catName) {
                this.currentCategory = catName;
                const idx = this.indexes[catName];
                const list = CATEGORIES[catName];
                
                if (idx >= list.length) {
                    return; // Should be disabled anyway
                }

                this.currentQ = list[idx];
                this.renderQuestion();
            },

            renderCategories() {
                this.ui.cats.innerHTML = '';
                Object.keys(CATEGORIES).forEach(cat => {
                    const idx = this.indexes[cat];
                    const list = CATEGORIES[cat];
                    const remaining = list.length - idx;
                    const isDone = remaining === 0;
                    
                    const btn = document.createElement('div');
                    btn.className = `cat-btn ${isDone ? 'disabled' : ''}`;
                    
                    let icon = 'fa-star';
                    if(cat.includes('Light')) icon = 'fa-lightbulb';
                    if(cat.includes('Space')) icon = 'fa-rocket';
                    if(cat.includes('Refraction')) icon = 'fa-glasses';
                    if(cat.includes('Math')) icon = 'fa-calculator';

                    // Determine badge
                    let badgeHtml = '';
                    if (!isDone) {
                        const nextQ = list[idx];
                        const diffClass = `diff-${nextQ.type.toLowerCase()}`;
                        badgeHtml = `<span class="cat-badge ${diffClass}">${nextQ.type}</span>`;
                    } else {
                        badgeHtml = `<span class="cat-badge diff-done">Done</span>`;
                    }

                    btn.innerHTML = `
                        <div class="cat-icon-box"><i class="fas ${icon}"></i></div>
                        <span style="font-weight:700;">${cat}</span>
                        <div class="cat-meta">
                            ${badgeHtml}
                            <span class="cat-count">${remaining} left</span>
                        </div>
                    `;
                    
                    if(!isDone) {
                        btn.onclick = () => this.selectCategory(cat);
                    }
                    this.ui.cats.appendChild(btn);
                });
            },

            renderQuestion() {
                // DOM Elements
                const els = {
                    badge: document.getElementById('q-badge'),
                    topic: document.getElementById('q-topic'),
                    text: document.getElementById('q-text'),
                    answer: document.getElementById('a-text'),
                    reveal: document.getElementById('btn-reveal'),
                    correct: document.getElementById('btn-correct'),
                    wrong: document.getElementById('btn-wrong'),
                };

                // Set Data
                els.badge.innerText = this.currentQ.type;
                els.badge.className = `badge badge-${this.currentQ.type.toLowerCase()}`;
                els.topic.innerText = this.currentCategory;
                els.text.innerText = this.currentQ.q;
                els.answer.innerText = this.currentQ.a;
                els.answer.classList.remove('visible');

                // Button State
                els.reveal.style.display = 'block';
                els.correct.style.display = 'none';
                els.wrong.style.display = 'none';

                // View Switch
                this.ui.cats.style.display = 'none';
                this.ui.question.style.display = 'flex';
            },

            revealAnswer() {
                document.getElementById('a-text').classList.add('visible');
                document.getElementById('btn-reveal').style.display = 'none';
                document.getElementById('btn-correct').style.display = 'block';
                document.getElementById('btn-wrong').style.display = 'block';
            },

            handleResult(isCorrect) {
                this.stats.total++;
                if (isCorrect) {
                    this.stats.correct++;
                    confettiEffects.fire();
                }

                // Increment index
                this.indexes[this.currentCategory]++;
                
                this.updateStats();

                // Unlock Turn
                this.turnActive = false;
                this.ui.spinBtn.disabled = false;
                
                // If the array size changed in startTurn, we need to redraw the wheel now
                // so it's ready for the next spin.
                // Note: This will visually shift the wheel segments.
                // To minimize jarring, we re-render.
                this.renderWheel();

                // Reset UI
                this.ui.question.style.display = 'none';
                this.ui.intro.style.display = 'block';
                this.ui.turnDisplay.classList.remove('active');
                this.ui.turnText.innerText = "Spin the Wheel!";
                setTimeout(() => this.ui.turnDisplay.classList.add('active'), 100);
            },

            // --- UTILS ---
            resetStudents() {
                if(confirm("Reset the student pool?")) {
                    this.activeStudents = [...this.initialStudents];
                    this.renderWheel();
                    this.updateStats();
                }
            },
            
            updateStats() {
                const percent = this.stats.total === 0 ? 0 : Math.round((this.stats.correct / this.stats.total) * 100);
                
                document.getElementById('score-percent').innerText = percent + "%";
                document.getElementById('score-correct').innerText = this.stats.correct;
                document.getElementById('score-total').innerText = this.stats.total;
                document.getElementById('progress-fill').style.width = percent + "%";
                document.getElementById('students-left-count').innerText = this.activeStudents.length;

                // Color coding
                const pEl = document.getElementById('score-percent');
                if (percent >= 60) pEl.style.color = "var(--neon-green)";
                else if (percent > 0) pEl.style.color = "var(--neon-pink)";
            },

            useLifeline(type) {
                if (this.lifelines[type] > 0) {
                    this.lifelines[type]--;
                    document.getElementById(`count-${type}`).innerText = this.lifelines[type];
                    if(this.lifelines[type] === 0) {
                        document.getElementById(`life-${type}`).disabled = true;
                    }
                }
            },

            openManualPick() {
                const list = document.getElementById('manual-list');
                list.innerHTML = '';
                this.activeStudents.forEach((name, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'student-btn';
                    btn.innerText = name;
                    btn.onclick = () => {
                        this.closeManualModal();
                        // Manually triggering turn also locks spin
                        this.turnActive = true;
                        this.startTurn(name, idx);
                    };
                    list.appendChild(btn);
                });
                
                const modal = document.getElementById('manual-modal');
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('active'), 10);
            },

            closeManualModal() {
                const modal = document.getElementById('manual-modal');
                modal.classList.remove('active');
                setTimeout(() => modal.style.display = 'none', 300);
            }
        };

        // --- VISUAL EFFECTS ---
        const confettiEffects = {
            canvas: null,
            ctx: null,
            particles: [],
            
            init() {
                this.canvas = document.getElementById('confetti');
                this.ctx = this.canvas.getContext('2d');
                this.resize();
                window.addEventListener('resize', () => this.resize());
                this.animate();
            },

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            },

            fire() {
                const colors = ['#22d3ee', '#f43f5e', '#c084fc', '#f59e0b', '#22c55e'];
                for(let i=0; i<150; i++) {
                    this.particles.push({
                        x: window.innerWidth / 2,
                        y: window.innerHeight / 2,
                        vx: (Math.random() - 0.5) * 25,
                        vy: (Math.random() - 0.5) * 25,
                        size: Math.random() * 6 + 2,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        life: 1,
                        decay: Math.random() * 0.015 + 0.005
                    });
                }
            },

            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                for(let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.3; // Gravity
                    p.life -= p.decay;

                    if(p.life <= 0) {
                        this.particles.splice(i, 1);
                    } else {
                        this.ctx.globalAlpha = p.life;
                        this.ctx.fillStyle = p.color;
                        this.ctx.beginPath();
                        this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                        this.ctx.fill();
                        this.ctx.globalAlpha = 1;
                    }
                }
                requestAnimationFrame(() => this.animate());
            }
        };

        // BOOTSTRAP
        game.initLobby();

    </script>
</body>
</html>
