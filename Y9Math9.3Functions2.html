<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9.3 Representing Functions</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&family=Plus+Jakarta+Sans:wght@400;500;700;800&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* --- CSS VARIABLES & THEME (EXACT MATCH) --- */
        :root {
            --bg-deep: #0f0518;         
            --bg-card: #1e1b2e;         
            
            --primary: #8b5cf6;   /* Violet */
            --secondary: #f43f5e; /* Rose - OUTPUTS */
            --accent: #06b6d4;    /* Cyan - INPUTS */
            --success: #10b981;   /* Emerald */
            --warning: #f59e0b;   /* Amber */

            --text-main: #ffffff;        
            --text-muted: #e2e8f0;     

            --header-h: 70px;
            --footer-h: 80px;
            --border-radius: 16px;
            
            --fs-h1: clamp(2.5rem, 5vw, 5rem);
            --fs-h2: clamp(1.8rem, 3.5vw, 3.5rem);
            --fs-h3: clamp(1.2rem, 2vw, 2rem);
            --fs-body: clamp(1.1rem, 1.2vw, 1.5rem);
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-deep);
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(139, 92, 246, 0.15), transparent 40%),
                radial-gradient(circle at 85% 75%, rgba(244, 63, 94, 0.1), transparent 40%),
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 100% 100%, 100% 100%, 40px 40px, 40px 40px;
            color: var(--text-main);
        }

        /* --- LAYOUT --- */
        .app-shell { display: flex; flex-direction: column; height: 100vh; }

        .header {
            height: var(--header-h);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
            background: rgba(15, 5, 24, 0.9);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .brand-pill {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            padding: 0.4rem 1.2rem;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-weight: 800;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: white;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
        }

        .viewport {
            flex: 1;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .slide-wrapper {
            min-height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .footer {
            height: var(--footer-h);
            background: rgba(15, 5, 24, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            z-index: 10;
        }

        /* --- COMPONENTS --- */
        .btn {
            cursor: pointer;
            border: none;
            border-radius: 12px;
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .btn:active { transform: scale(0.96); }
        
        .btn-nav {
            width: 56px;
            height: 56px;
            background: var(--bg-card);
            color: var(--text-main);
            font-size: 1.2rem;
            border: 2px solid rgba(255,255,255,0.2);
        }
        .btn-nav:hover:not(:disabled) {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.6);
        }
        .btn-nav:disabled { opacity: 0.3; cursor: not-allowed; }

        .btn-reveal {
            background: var(--primary);
            color: white;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            width: 100%;
            margin-top: 1rem;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .btn-reveal:hover { background: #7c3aed; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(139, 92, 246, 0.4); }
        
        /* Pedagogical Pills */
        .num-pill {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
            height: 60px;
            border-radius: 12px;
            font-size: 1.5rem;
            padding: 0 1rem;
            margin: 0 0.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }
        
        .pill-input { background: rgba(6, 182, 212, 0.25); color: var(--accent); border-color: var(--accent); }
        .pill-output { background: rgba(244, 63, 94, 0.25); color: var(--secondary); border-color: var(--secondary); }
        .pill-neutral { background: #334155; color: white; }

        .progress-container {
            flex: 1;
            margin: 0 2rem;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent), var(--secondary));
            transition: width 0.4s ease;
        }

        /* Typography & Layout */
        .text-center { text-align: center; }
        h1 { font-size: var(--fs-h1); font-family: 'Outfit', sans-serif; line-height: 1.1; margin-bottom: 1rem; color: white; text-shadow: 0 0 20px rgba(139, 92, 246, 0.5); }
        h2 { font-size: var(--fs-h2); font-family: 'Outfit', sans-serif; margin-bottom: 1.5rem; color: white; }
        h3 { font-size: var(--fs-h3); font-family: 'Outfit', sans-serif; margin-bottom: 1rem; color: white; }
        p, li { font-size: var(--fs-body); color: var(--text-muted); line-height: 1.6; }
        strong { color: white; font-weight: 800; }
        
        .text-accent { color: var(--accent); }
        .text-secondary { color: var(--secondary); }
        .text-primary { color: var(--primary); }

        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 3rem; align-items: center; }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        /* --- FUNCTION MACHINE GRAPHICS --- */
        .machine-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .machine-box {
            background: #334155;
            border: 2px solid white;
            padding: 1.5rem;
            border-radius: 12px;
            position: relative;
            min-width: 120px;
            text-align: center;
            font-family: 'Outfit', sans-serif;
            font-weight: 800;
            font-size: 1.5rem;
            cursor: default;
        }
        .machine-box.clickable { cursor: pointer; transition: 0.2s; }
        .machine-box.clickable:hover { transform: scale(1.05); border-color: var(--primary); }

        .machine-box::before, .machine-box::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 15px;
            height: 4px;
            background: white;
        }
        .machine-box::before { left: -15px; }
        .machine-box::after { right: -15px; }

        .arrow-right {
            font-size: 2rem;
            color: var(--text-muted);
            animation: pulse 2s infinite;
        }

        /* --- SPOILER PROTECTION --- */
        .spoiler-content {
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.5s ease;
            pointer-events: none;
            visibility: hidden;
        }
        .spoiler-content.revealed {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
            visibility: visible;
        }

        /* --- TABLES & WORKBOOK ELEMENTS --- */
        .wb-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0.5rem;
            margin-top: 1rem;
        }
        .wb-table th { color: var(--text-muted); padding: 1rem; font-size: 1.2rem; }
        .wb-table td { padding: 0.5rem; text-align: center; }
        
        .interactive-cell {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 1rem;
            font-family: 'JetBrains Mono';
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
            min-width: 60px;
        }
        .interactive-cell:hover { background: rgba(255,255,255,0.1); border-color: var(--primary); }
        .interactive-cell.solved { background: rgba(16, 185, 129, 0.2); border-color: var(--success); cursor: default; }

        /* Mapping Diagram Ovals */
        .mapping-oval {
            border: 3px solid rgba(255,255,255,0.2);
            border-radius: 50px;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            min-width: 100px;
            align-items: center;
            background: rgba(0,0,0,0.2);
            position: relative;
            z-index: 2;
        }

        /* Animations */
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; transform: translateX(5px); } 100% { opacity: 0.5; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        .fade-in { animation: fadeIn 0.6s ease-out; }
        .slide-up { animation: slideUp 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; }

        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; gap: 2rem; }
            h1 { font-size: 2.5rem; }
            .header { flex-direction: column; height: auto; padding: 1rem; gap: 0.5rem; }
        }
    </style>
</head>
<body>

<div class="app-shell">
    <header class="header">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div class="brand-pill">Year 9 Math</div>
            <div style="font-family: 'Outfit'; font-weight: 700; font-size: 1.2rem; color: var(--accent);">
                9.3 Representing Functions
            </div>
        </div>
        
        <div style="font-size: 1rem; color: var(--text-muted); font-weight: 500;">
            Tuesday 13 January 2026
        </div>
    </header>

    <main class="viewport" id="viewport">
        <div id="slide-container" class="slide-wrapper" aria-live="polite">
            <!-- Slides render here -->
        </div>
    </main>

    <footer class="footer">
        <button class="btn btn-nav" id="btn-prev" aria-label="Previous Slide">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
        
        <div class="progress-container">
            <div class="progress-fill" id="progress-bar"></div>
        </div>
        
        <button class="btn btn-nav" id="btn-next" aria-label="Next Slide">
            <i class="fa-solid fa-chevron-right"></i>
        </button>
    </footer>
</div>

<script>
    // Global State for Scaffolding
    const state = {
        currentSlide: 0,
        slides: []
    };

    // --- SLIDE CONTENT ---
    state.slides = [
        // Slide 0: Objectives (Formal)
        {
            render: () => `
                <div class="text-center fade-in">
                    <div style="font-size: 5rem; margin-bottom: 1rem; color: var(--accent);">üéØ</div>
                    <h1>Learning Objectives</h1>
                    <p style="font-size: 1.5rem; color: var(--secondary); font-weight: 600;">By the end of this lesson, you will be able to:</p>
                    
                    <div class="card slide-up" style="margin-top: 3rem; max-width: 800px; margin-left: auto; margin-right: auto; text-align: left;">
                        <ul style="list-style: none; display: grid; gap: 1.5rem;">
                            <li style="display: flex; align-items: center; gap: 1rem; font-size: 1.3rem; color: white;">
                                <div class="num-pill pill-neutral" style="width: 40px; height: 40px; font-size: 1rem; min-width: 40px;">1</div>
                                <span>Complete function tables using machines.</span>
                            </li>
                            <li style="display: flex; align-items: center; gap: 1rem; font-size: 1.3rem; color: white;">
                                <div class="num-pill pill-neutral" style="width: 40px; height: 40px; font-size: 1rem; min-width: 40px;">2</div>
                                <span>Distinguish between addition and squaring in order of operations.</span>
                            </li>
                            <li style="display: flex; align-items: center; gap: 1rem; font-size: 1.3rem; color: white;">
                                <div class="num-pill pill-neutral" style="width: 40px; height: 40px; font-size: 1rem; min-width: 40px;">3</div>
                                <span>Calculate inputs by reversing function machines.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            `
        },

        // Slide 1: Q1 & Q2 (Scaffolded Table Filling - Spoilers Hidden)
        {
            render: () => `
                <div class="fade-in text-center">
                    <span class="brand-pill" style="background: var(--accent);">Q1 & Q2</span>
                    <h2>From Machines to Tables</h2>
                    <p>Click the <strong class="text-accent">Table Cells</strong> below to test the numbers.</p>

                    <div class="grid-2 slide-up" style="gap: 2rem; margin-top: 2rem;">
                        <!-- Machine Visual -->
                        <div class="card" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 250px;">
                            <h3 style="color: var(--text-muted);">Machine A</h3>
                            <div class="machine-container">
                                <div class="num-pill pill-input" id="demo-in">x</div>
                                <i class="fa-solid fa-arrow-right arrow-right"></i>
                                <div class="machine-box" style="border-color: var(--primary); color: var(--primary);">Square</div>
                                <i class="fa-solid fa-arrow-right arrow-right"></i>
                                <div class="machine-box">+ 1</div>
                                <i class="fa-solid fa-arrow-right arrow-right"></i>
                                <div class="num-pill pill-output" id="demo-out">y</div>
                            </div>
                            <!-- Hidden until interaction -->
                            <div class="spoiler-content" id="eq-reveal" style="margin-top: 1rem; font-family: 'JetBrains Mono'; color: var(--success);">
                                Equation: y = x¬≤ + 1
                            </div>
                        </div>

                        <!-- Interactive Table -->
                        <div class="card">
                            <h3>Table of Values</h3>
                            <table class="wb-table">
                                <tr>
                                    <th class="text-accent">Input (x)</th>
                                    <td><div class="num-pill pill-input" style="width:50px; height:50px;">2</div></td>
                                    <td><div class="num-pill pill-input" style="width:50px; height:50px;">3</div></td>
                                    <td><div class="num-pill pill-input" style="width:50px; height:50px;">5</div></td>
                                </tr>
                                <tr>
                                    <th class="text-secondary">Output (y)</th>
                                    <td><button class="interactive-cell" onclick="runMachine(2, 5, this)">?</button></td>
                                    <td><button class="interactive-cell" onclick="runMachine(3, 10, this)">?</button></td>
                                    <td><button class="interactive-cell" onclick="runMachine(5, 26, this)">?</button></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            `
        },

        // Slide 2: Q2d (Mapping Diagrams - Spoilers Hidden)
        {
            render: () => `
                <div class="fade-in text-center">
                    <span class="brand-pill" style="background: var(--primary);">Q2 Part D</span>
                    <h2>Mapping Diagrams</h2>
                    <p>Connect the Input to the correct Output for: <strong class="text-primary">y = x¬≤</strong></p>

                    <div class="card slide-up" style="margin-top: 2rem; position: relative; max-width: 800px; margin-left:auto; margin-right:auto;">
                        <svg id="mapping-svg" style="position: absolute; top:0; left:0; width:100%; height:100%; z-index: 1; pointer-events:none;">
                            <!-- Lines will be drawn here by JS -->
                        </svg>

                        <div style="display: flex; justify-content: space-around; align-items: center; padding: 2rem;">
                            <div>
                                <h4 class="text-accent" style="margin-bottom: 1rem;">x</h4>
                                <div class="mapping-oval" style="border-color: var(--accent);">
                                    <button class="num-pill pill-input" id="map-in-1" onclick="selectMapping(1, 2)" style="cursor:pointer;">2</button>
                                    <button class="num-pill pill-input" id="map-in-2" onclick="selectMapping(2, 4)" style="cursor:pointer;">4</button>
                                    <button class="num-pill pill-input" id="map-in-3" onclick="selectMapping(3, 5)" style="cursor:pointer;">5</button>
                                </div>
                            </div>

                            <div style="color: var(--text-muted); width: 100px; text-align: center;">
                                Connect<br>&rarr;
                            </div>

                            <div>
                                <h4 class="text-secondary" style="margin-bottom: 1rem;">y</h4>
                                <div class="mapping-oval" style="border-color: var(--secondary);">
                                    <div class="num-pill pill-output" id="map-out-2">4</div>
                                    <div class="num-pill pill-output" id="map-out-5">25</div>
                                    <div class="num-pill pill-output" id="map-out-4">16</div>
                                </div>
                            </div>
                        </div>
                        <p id="map-feedback" style="height: 1.5rem; color: var(--warning); font-weight: bold;"></p>
                    </div>
                </div>
            `
        },

        // Slide 3: Q3 Order of Operations (Spoilers Hidden)
        {
            render: () => `
                <div class="fade-in text-center">
                    <span class="brand-pill" style="background: var(--warning);">Q3: Careful!</span>
                    <h2>Order Matters</h2>
                    <p>Compare Machine A and Machine B using input <strong>4</strong>.</p>
                    
                    <div class="grid-2 slide-up" style="align-items: flex-start;">
                        <!-- Machine A -->
                        <div class="card">
                            <h3><span style="color: var(--primary);">A:</span> y = x¬≤ + 1</h3>
                            <div class="machine-container" style="font-size: 0.8rem; gap: 0.5rem; margin: 1rem 0;">
                                <div class="num-pill pill-input" style="width:40px; height:40px;">4</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="machine-box">x¬≤</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="machine-box">+1</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="num-pill pill-neutral" id="res-a" style="width:50px; height:50px;">?</div>
                            </div>
                            <button class="btn btn-nav btn-sm" onclick="document.getElementById('res-a').innerText='17'; document.getElementById('res-a').classList.add('pill-output'); document.getElementById('expl-a').classList.add('revealed');">Run (4)</button>
                            <!-- Hidden Explanation -->
                            <div id="expl-a" class="spoiler-content" style="margin-top:1rem; text-align: left; font-size: 0.9rem; color: var(--text-muted);">
                                4¬≤ = 16<br>
                                16 + 1 = <strong>17</strong>
                            </div>
                        </div>

                        <!-- Machine B -->
                        <div class="card">
                            <h3><span style="color: var(--warning);">B:</span> y = (x + 1)¬≤</h3>
                            <div class="machine-container" style="font-size: 0.8rem; gap: 0.5rem; margin: 1rem 0;">
                                <div class="num-pill pill-input" style="width:40px; height:40px;">4</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="machine-box">+1</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="machine-box">x¬≤</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="num-pill pill-neutral" id="res-b" style="width:50px; height:50px;">?</div>
                            </div>
                            <button class="btn btn-nav btn-sm" onclick="document.getElementById('res-b').innerText='25'; document.getElementById('res-b').classList.add('pill-output'); document.getElementById('expl-b').classList.add('revealed');">Run (4)</button>
                            <!-- Hidden Explanation -->
                            <div id="expl-b" class="spoiler-content" style="margin-top:1rem; text-align: left; font-size: 0.9rem; color: var(--text-muted);">
                                4 + 1 = 5<br>
                                5¬≤ = <strong>25</strong>
                            </div>
                        </div>
                    </div>
                </div>
            `
        },

        // --- NEW SLIDE: Q4 Operations Mix ---
        {
            render: () => `
                <div class="fade-in text-center">
                    <span class="brand-pill" style="background: var(--accent);">Q4: Compare</span>
                    <h2>Does Order Change the Output?</h2>
                    <p>Calculate the output for both machines using Input = <strong>3</strong>.</p>
                    
                    <div class="grid-2 slide-up" style="gap: 2rem;">
                        <!-- Machine 1 -->
                        <div class="card">
                            <h3 class="text-accent">Machine 1</h3>
                            <div class="machine-container" style="justify-content:center; gap:0.5rem; font-size: 0.9rem;">
                                <div class="num-pill pill-input" style="width:40px; height:40px;">3</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="machine-box">+ 2</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="machine-box">&times; 5</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="num-pill pill-neutral" id="q4-out-1" style="width:50px; height:50px;">?</div>
                            </div>
                            <button class="btn btn-nav btn-sm" onclick="document.getElementById('q4-out-1').innerText='25'; document.getElementById('q4-out-1').classList.add('pill-output'); checkQ4();">Check</button>
                        </div>

                        <!-- Machine 2 -->
                        <div class="card">
                            <h3 class="text-secondary">Machine 2</h3>
                            <div class="machine-container" style="justify-content:center; gap:0.5rem; font-size: 0.9rem;">
                                <div class="num-pill pill-input" style="width:40px; height:40px;">3</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="machine-box">&times; 5</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="machine-box">+ 2</div>
                                <i class="fa-solid fa-arrow-right"></i>
                                <div class="num-pill pill-neutral" id="q4-out-2" style="width:50px; height:50px;">?</div>
                            </div>
                            <button class="btn btn-nav btn-sm" onclick="document.getElementById('q4-out-2').innerText='17'; document.getElementById('q4-out-2').classList.add('pill-output'); checkQ4();">Check</button>
                        </div>
                    </div>

                    <div id="q4-conclusion" class="spoiler-content" style="margin-top: 2rem; padding: 1rem; border: 1px solid var(--warning); border-radius: 12px; display: inline-block;">
                        <strong style="color: var(--warning); font-size: 1.5rem;">Observation:</strong><br>
                        (3 + 2) √ó 5 = 25<br>
                        (3 √ó 5) + 2 = 17<br>
                        They are <strong style="text-decoration: underline;">NOT</strong> the same.
                    </div>
                </div>
            `
        },

        // --- NEW SLIDE: Q6 Build the Machine ---
        {
            render: () => `
                <div class="fade-in text-center">
                    <span class="brand-pill" style="background: var(--primary);">Q6: Draw It</span>
                    <h2>Build the Machine</h2>
                    <p>Which operations represent this equation?</p>
                    <div style="font-family: 'JetBrains Mono'; font-size: 3rem; margin: 1rem 0; color: var(--success);">
                        y = 4x - 1
                    </div>

                    <div class="card slide-up" style="max-width: 800px; margin: 0 auto;">
                        <p style="margin-bottom: 2rem;">Click the correct blocks in order:</p>
                        
                        <!-- The Construction Zone -->
                        <div class="machine-container">
                            <div class="num-pill pill-input">x</div>
                            <i class="fa-solid fa-arrow-right arrow-right"></i>
                            
                            <!-- Step 1 Choice -->
                            <div id="step1-slot" style="min-width: 100px; min-height: 80px; border: 2px dashed var(--text-muted); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: var(--text-muted);">Step 1?</span>
                            </div>
                            
                            <i class="fa-solid fa-arrow-right arrow-right"></i>

                            <!-- Step 2 Choice -->
                            <div id="step2-slot" style="min-width: 100px; min-height: 80px; border: 2px dashed var(--text-muted); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: var(--text-muted);">Step 2?</span>
                            </div>

                            <i class="fa-solid fa-arrow-right arrow-right"></i>
                            <div class="num-pill pill-output">y</div>
                        </div>

                        <!-- Options Bank -->
                        <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
                            <button class="machine-box clickable" onclick="fillSlot(this, '&times; 4')">&times; 4</button>
                            <button class="machine-box clickable" onclick="fillSlot(this, '- 1')">- 1</button>
                            <button class="machine-box clickable" onclick="fillSlot(this, '+ 4')">+ 4</button>
                        </div>
                        
                        <div id="build-feedback" style="height: 2rem; margin-top: 1rem; font-weight: bold;"></div>
                        <button class="btn btn-reveal" id="reset-build" style="display:none; width: auto; margin: 1rem auto;" onclick="resetBuild()">Reset</button>
                    </div>
                </div>
            `
        },

        // Slide 6: Q7 Negatives (Spoilers Hidden)
        {
            render: () => `
                <div class="fade-in text-center">
                    <span class="brand-pill" style="background: var(--secondary);">Q7</span>
                    <h2>Negative Inputs</h2>
                    <p>What happens when we put <strong>-6</strong> into this machine?</p>

                    <div class="card slide-up" style="max-width: 800px; margin: 2rem auto;">
                         <div class="machine-container">
                            <div class="num-pill pill-input">-6</div>
                            <i class="fa-solid fa-arrow-right arrow-right"></i>
                            <div class="machine-box">x¬≤</div>
                            <i class="fa-solid fa-arrow-right arrow-right"></i>
                            <div class="machine-box">&div; 2</div>
                            <i class="fa-solid fa-arrow-right arrow-right"></i>
                            <div class="num-pill pill-neutral" id="neg-out">?</div>
                        </div>

                        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                            <button class="btn btn-reveal" style="width: auto; background: var(--bg-deep); color: var(--text-muted);" onclick="alert('Incorrect! Remember: Negative √ó Negative = Positive.')">-18</button>
                            <button class="btn btn-reveal" style="width: auto;" onclick="document.getElementById('neg-out').innerText='18'; document.getElementById('neg-out').classList.add('pill-output'); document.getElementById('neg-expl').classList.add('revealed');">18</button>
                        </div>
                        
                        <!-- Hidden Logic -->
                        <div id="neg-expl" class="spoiler-content" style="margin-top: 2rem; padding: 1rem; border: 1px dashed var(--text-muted); border-radius: 8px; text-align: left;">
                            <p><strong>Correction:</strong></p>
                            <ol style="margin-left: 2rem; color: var(--text-muted);">
                                <li>(-6)¬≤ = 36 <span style="color: var(--success);">(Positive!)</span></li>
                                <li>36 &div; 2 = 18</li>
                            </ol>
                        </div>
                    </div>
                </div>
            `
        },

        // Slide 7: Q8/11 Sofia & Zara (Spoilers Hidden)
        {
            render: () => `
                <div class="fade-in text-center">
                    <span class="brand-pill" style="background: var(--primary);">Q8 / Q11</span>
                    <h2>Who is Correct?</h2>
                    <p>Read their statement, then click <strong>Check Hypothesis</strong> to see if they are right.</p>
                    
                    <div class="grid-2 slide-up" style="gap: 1.5rem;">
                        <!-- Sofia -->
                        <div class="card" style="border-top: 4px solid #fbbf24;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="width: 50px; height: 50px; background: #fbbf24; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">S</div>
                                <h3>Sofia</h3>
                            </div>
                            <p style="font-style: italic; color: var(--text-muted);">"For <strong style="color:white">y = x¬≤</strong>, positive and negative inputs give the same output."</p>
                            
                            <button class="btn btn-nav btn-sm" style="margin-top:1rem; width: 100%;" onclick="document.getElementById('sofia-check').classList.add('revealed')">Check Hypothesis</button>

                            <!-- Hidden Result -->
                            <div id="sofia-check" class="spoiler-content">
                                <div style="margin-top: 1.5rem; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                                    <div>Input <strong>2</strong> &rarr; 2¬≤ = <strong class="text-success">4</strong></div>
                                    <div>Input <strong>-2</strong> &rarr; (-2)¬≤ = <strong class="text-success">4</strong></div>
                                </div>
                                <div style="margin-top: 1rem; color: #fbbf24; font-weight: 800; font-size: 1.5rem;">‚úì TRUE</div>
                            </div>
                        </div>

                        <!-- Zara -->
                        <div class="card" style="border-top: 4px solid #a78bfa;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="width: 50px; height: 50px; background: #a78bfa; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">Z</div>
                                <h3>Zara</h3>
                            </div>
                            <p style="font-style: italic; color: var(--text-muted);">"For <strong style="color:white">y = (x+1)¬≤</strong>, positive and negative inputs give the same output."</p>
                            
                            <button class="btn btn-nav btn-sm" style="margin-top:1rem; width: 100%;" onclick="document.getElementById('zara-check').classList.add('revealed')">Check Hypothesis</button>

                            <!-- Hidden Result -->
                            <div id="zara-check" class="spoiler-content">
                                <div style="margin-top: 1.5rem; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                                    <div>Input <strong>2</strong> &rarr; (3)¬≤ = <strong class="text-success">9</strong></div>
                                    <div>Input <strong>-2</strong> &rarr; (-1)¬≤ = <strong class="text-secondary">1</strong></div>
                                </div>
                                <div style="margin-top: 1rem; color: var(--secondary); font-weight: 800; font-size: 1.5rem;">‚úó FALSE</div>
                            </div>
                        </div>
                    </div>
                </div>
            `
        },

        // Slide 8: Q9 Reverse Equations (Spoilers Hidden)
        {
            render: () => `
                <div class="fade-in text-center">
                    <span class="brand-pill" style="background: var(--warning);">Q9</span>
                    <h2>Reverse the Machine</h2>
                    <p>Find the inverse equation by working backwards.</p>

                    <div class="card slide-up" style="max-width: 800px; margin: 2rem auto;">
                        <h3 style="text-align: left; color: var(--text-muted);">Original: y = 3x - 10</h3>
                        
                        <!-- Forward -->
                        <div class="machine-container" style="opacity: 0.6; transform: scale(0.9);">
                            <div class="num-pill pill-input">x</div>
                            <i class="fa-solid fa-arrow-right arrow-right"></i>
                            <div class="machine-box">&times; 3</div>
                            <i class="fa-solid fa-arrow-right arrow-right"></i>
                            <div class="machine-box">- 10</div>
                            <i class="fa-solid fa-arrow-right arrow-right"></i>
                            <div class="num-pill pill-output">y</div>
                        </div>

                        <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 2rem 0;">

                        <!-- Reverse -->
                        <h3 style="text-align: left; color: var(--warning);">Reverse: x = ?</h3>
                        <div class="machine-container">
                            <div class="num-pill pill-output">y</div>
                            <i class="fa-solid fa-arrow-right arrow-right" style="color: var(--warning);"></i>
                            
                            <button class="machine-box" style="cursor: pointer; border-color: var(--warning); color: var(--warning);" 
                                onclick="this.innerText='+ 10'; this.style.background='var(--bg-deep)';">
                                ?
                            </button>
                            
                            <i class="fa-solid fa-arrow-right arrow-right" style="color: var(--warning);"></i>
                            
                            <button class="machine-box" style="cursor: pointer; border-color: var(--warning); color: var(--warning);"
                                onclick="this.innerText='&div; 3'; this.style.background='var(--bg-deep)'; document.getElementById('inv-reveal-btn').classList.add('revealed')">
                                ?
                            </button>
                            
                            <i class="fa-solid fa-arrow-right arrow-right" style="color: var(--warning);"></i>
                            <div class="num-pill pill-input">x</div>
                        </div>
                        <p style="color: var(--text-muted);">Click the boxes to reverse the operations.</p>
                        
                        <div id="inv-reveal-btn" class="spoiler-content">
                             <button class="btn btn-nav btn-sm" style="margin-top:1rem;" onclick="document.getElementById('inv-eq').classList.add('revealed')">Show Final Equation</button>
                        </div>

                        <div id="inv-eq" class="spoiler-content" style="margin-top: 2rem; font-size: 1.5rem; font-family: 'JetBrains Mono'; color: var(--success);">
                            x = (y + 10) / 3
                        </div>
                    </div>
                </div>
            `
        },
        // Slide 9: Summary
        {
            render: () => `
                <div class="text-center fade-in">
                    <h2>üìù Homework Checklist</h2>
                    <div class="card slide-up" style="max-width: 600px; margin: 2rem auto; text-align: left;">
                        <ul style="list-style: none; font-size: 1.2rem; display: grid; gap: 1.5rem;">
                            <li style="display: flex; gap: 1rem; align-items: center;">
                                <i class="fa-solid fa-square-check" style="color: var(--success);"></i>
                                <span><strong>Q1 & Q2:</strong> Draw tables neatly in notebook.</span>
                            </li>
                            <li style="display: flex; gap: 1rem; align-items: center;">
                                <i class="fa-solid fa-square-check" style="color: var(--success);"></i>
                                <span><strong>Q4:</strong> Watch out for order (Square first? or Add first?).</span>
                            </li>
                            <li style="display: flex; gap: 1rem; align-items: center;">
                                <i class="fa-solid fa-square-check" style="color: var(--success);"></i>
                                <span><strong>Q7:</strong> Negative inputs. Remember (-5)¬≤ = 25.</span>
                            </li>
                            <li style="display: flex; gap: 1rem; align-items: center;">
                                <i class="fa-solid fa-square-check" style="color: var(--success);"></i>
                                <span><strong>Q9:</strong> Write the reverse equation.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            `
        }
    ];

    // --- INTERACTIVE LOGIC ---

    // For Slide 1 (Table Scaffolding)
    function runMachine(input, expected, btn) {
        document.getElementById('demo-in').innerText = input;
        setTimeout(() => {
            document.getElementById('demo-out').innerText = expected;
            btn.innerText = expected;
            btn.classList.add('solved');
            document.getElementById('eq-reveal').classList.add('revealed');
        }, 300);
    }

    // For Slide 2 (Mapping)
    let selectedInput = null;
    let selectedInputVal = null;
    
    function selectMapping(id, val) {
        selectedInput = id;
        selectedInputVal = val;
        document.querySelectorAll('.mapping-oval .pill-input').forEach(el => el.style.borderColor = 'var(--accent)');
        document.getElementById(`map-in-${id}`).style.borderColor = 'white';
        document.getElementById('map-feedback').innerText = "Select the matching output...";
    }

    document.addEventListener('click', (e) => {
        if(e.target.classList.contains('pill-output') && e.target.parentElement.classList.contains('mapping-oval') && selectedInput) {
            const targetVal = parseInt(e.target.innerText);
            const expected = selectedInputVal * selectedInputVal; // y = x^2
            
            if(targetVal === expected) {
                document.getElementById('map-feedback').innerText = "Correct!";
                document.getElementById('map-feedback').style.color = "var(--success)";
                drawConnection(selectedInput, e.target);
                e.target.style.background = "var(--primary)";
                selectedInput = null;
            } else {
                document.getElementById('map-feedback').innerText = "Try again!";
                document.getElementById('map-feedback').style.color = "var(--secondary)";
            }
        }
    });

    function drawConnection(inputId, targetEl) {
        const svg = document.getElementById('mapping-svg');
        const inputEl = document.getElementById(`map-in-${inputId}`);
        
        const rect1 = inputEl.getBoundingClientRect();
        const rect2 = targetEl.getBoundingClientRect();
        const containerRect = svg.getBoundingClientRect(); 

        const x1 = rect1.right - containerRect.left;
        const y1 = rect1.top + (rect1.height/2) - containerRect.top;
        const x2 = rect2.left - containerRect.left;
        const y2 = rect2.top + (rect2.height/2) - containerRect.top;

        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', x1);
        line.setAttribute('y1', y1);
        line.setAttribute('x2', x2);
        line.setAttribute('y2', y2);
        line.setAttribute('stroke', 'white');
        line.setAttribute('stroke-width', '2');
        line.setAttribute('stroke-dasharray', '5,5');
        svg.appendChild(line);
    }

    // For Slide 4 (Operations Mix)
    function checkQ4() {
        const el1 = document.getElementById('q4-out-1');
        const el2 = document.getElementById('q4-out-2');
        if (el1.classList.contains('pill-output') && el2.classList.contains('pill-output')) {
            document.getElementById('q4-conclusion').classList.add('revealed');
        }
    }

    // For Slide 5 (Build Machine)
    let buildStep = 0;
    
    function fillSlot(btn, op) {
        if(buildStep === 0) {
            if(op === '&times; 4') {
                document.getElementById('step1-slot').innerHTML = `<span style="font-size:1.5rem; font-weight:bold; color:white;">${op}</span>`;
                document.getElementById('step1-slot').style.borderColor = 'var(--primary)';
                document.getElementById('step1-slot').style.background = 'var(--bg-deep)';
                buildStep = 1;
                document.getElementById('build-feedback').innerText = "Good! Now select Step 2.";
                document.getElementById('build-feedback').style.color = "var(--text-muted)";
            } else {
                document.getElementById('build-feedback').innerText = "Incorrect for y = 4x...";
                document.getElementById('build-feedback').style.color = "var(--secondary)";
            }
        } else if (buildStep === 1) {
            if(op === '- 1') {
                document.getElementById('step2-slot').innerHTML = `<span style="font-size:1.5rem; font-weight:bold; color:white;">${op}</span>`;
                document.getElementById('step2-slot').style.borderColor = 'var(--primary)';
                document.getElementById('step2-slot').style.background = 'var(--bg-deep)';
                buildStep = 2;
                document.getElementById('build-feedback').innerText = "Perfect! 4x - 1";
                document.getElementById('build-feedback').style.color = "var(--success)";
                document.getElementById('reset-build').style.display = 'block';
            } else {
                document.getElementById('build-feedback').innerText = "Incorrect second step.";
                document.getElementById('build-feedback').style.color = "var(--secondary)";
            }
        }
    }

    function resetBuild() {
        buildStep = 0;
        document.getElementById('step1-slot').innerHTML = '<span style="color: var(--text-muted);">Step 1?</span>';
        document.getElementById('step2-slot').innerHTML = '<span style="color: var(--text-muted);">Step 2?</span>';
        document.getElementById('step1-slot').style.borderColor = 'var(--text-muted)';
        document.getElementById('step2-slot').style.borderColor = 'var(--text-muted)';
        document.getElementById('build-feedback').innerText = "";
        document.getElementById('reset-build').style.display = 'none';
    }


    // --- CORE RENDER ENGINE ---
    function render() {
        const container = document.getElementById('slide-container');
        const slide = state.slides[state.currentSlide];
        container.innerHTML = slide.render();
        
        // Update Progress
        const percent = ((state.currentSlide + 1) / state.slides.length) * 100;
        document.getElementById('progress-bar').style.width = `${percent}%`;
        
        // Nav Buttons
        document.getElementById('btn-prev').disabled = state.currentSlide === 0;
        document.getElementById('btn-next').disabled = state.currentSlide === state.slides.length - 1;
    }

    function changeSlide(dir) {
        const next = state.currentSlide + dir;
        if (next >= 0 && next < state.slides.length) {
            state.currentSlide = next;
            selectedInput = null;
            buildStep = 0; 
            render();
        }
    }

    // Bind Events
    document.getElementById('btn-prev').addEventListener('click', () => changeSlide(-1));
    document.getElementById('btn-next').addEventListener('click', () => changeSlide(1));

    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') changeSlide(1);
        if (e.key === 'ArrowLeft') changeSlide(-1);
    });

    // Init
    render();

</script>
</body>
</html>
